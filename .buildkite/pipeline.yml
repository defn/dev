steps:
  #  - command: buildkite-agent oidc request-token --lifetime 60
  #  - command: aws sts get-caller-identity
  #    plugins:
  #      - aws-assume-role-with-web-identity:
  #          role-arn: arn:aws:iam::510430971399:role/buildkite-agent-readonly
  - name: build
    command: false
    key: build
  - wait:
    continue_on_failure: true
  - name: debug
    command: |
      for s in build test cache; do
        if [[ $(buildkite-agent step get "outcome" --step "$s") == "hard_failed" ]]; then
          buildkite-agent annotate 'job $s failed' --style 'error'
          exec env - HOME=$HOME USER=$USER PATH=$PATH $(which code-server) --auth none
        fi
      done
