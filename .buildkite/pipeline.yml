env:
  BUILDKITE_GIT_MIRRORS_PATH: "/cache/git"
  BUILDKITE_GIT_MIRRORS_SKIP_UPDATE: "1"

steps:
  - label: bazel build
    plugins:
      - kubernetes:
          podSpec:
            containers:
              - image: cache.defn.run:5000/dfd:class
                imagePullPolicy: Always
                command: [bash, -c]
                args:
                  - "'git config user.email you@example.com && git config user.name YourName' && cd m && ../bin/b build"
                securityContext:
                  runAsNonRoot: true
                  runAsUser: 1000
                  runAsGroup: 1000
