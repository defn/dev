#!/usr/bin/env bash

export WORKDIR="${1:-${HOME-}}"

if [[ ${WORKDIR} == '${workspaceFolder}' ]]; then
	WORKDIR="${HOME-}"
fi

export workdir="${WORKDIR}"
export TMOUT=3600

if test -f ~/.bash_profile; then
	source ~/.bash_profile
fi

lockfile="/tmp/.bash_entrypoint.lock"

# Attempt to acquire the lock without blocking
if flock -n 200; then
	if ! test -r /tmp/.bash_entrypoint.done; then
		touch /tmp/.bash_entrypoint.done
		make tilt
	fi
fi 200>$lockfile

unset lockfile
