#!/usr/bin/env bash
# code - VSCode/code-server launcher wrapper
#
# Usage: code [options] [path]
#
# Launches VSCode or code-server depending on the environment.
# Automatically detects and uses the appropriate executable based
# on VSCODE_GIT_ASKPASS_MAIN environment variable.

function main {
	case "${VSCODE_GIT_ASKPASS_MAIN-}" in
	*code-server*)
		exec "${VSCODE_GIT_ASKPASS_MAIN%%extensions/*}"/bin/remote-cli/code-server "$@"
		;;
	*/.vscode-server/*)
		exec "${VSCODE_GIT_ASKPASS_MAIN%%extensions/*}"/bin/remote-cli/code-server "$@"
		;;
	/Applications/Visual*)
		exec "${VSCODE_GIT_ASKPASS_MAIN%%extensions/*}"/bin/code "$@"
		;;
	esac

	exec code-server "$@"
}

main "$@"
