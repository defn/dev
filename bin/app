#!/usr/bin/env bash

function main {
	set -efu -o pipefail

	case "${1-}" in
	repo)
		exec env KUBECONFIG=$HOME/.kube/config.argocd argocd --core "$@"
		;;
	sync | get | wait | terminate-op | resources | logs | diff)
		case "${2-}" in
		/*)
			exec env KUBECONFIG=$HOME/.kube/config.argocd argocd --core app "$1" "$(app list | tail -n +2 | awk '{print $1}' | fzf --query="${2#/}" --select-1 || true)"
			;;
		*)
			exec env KUBECONFIG=$HOME/.kube/config.argocd argocd --core app "$1" "${2-}"
			;;
		esac
		;;
	*)
		exec env KUBECONFIG=$HOME/.kube/config.argocd argocd --core app "$@"
		;;
	esac
}

main "$@"
