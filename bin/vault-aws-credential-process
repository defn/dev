#!/usr/bin/env bash

function main {
    set -efu

    set -- $(kv issue admin.gyre.defn.dev 1m "$(mktemp -d -t XXXXXX)")

    aws_signing_helper credential-process \
        --certificate "$1" --private-key "$2" \
        --trust-anchor-arn arn:aws:rolesanywhere:us-east-1:319951235442:trust-anchor/bcfd2f6f-388e-4cf8-a753-75238af6ada6 \
        --profile-arn arn:aws:rolesanywhere:us-east-1:319951235442:profile/f903c6fc-931e-4163-bc62-6e44252526ac \
        --role-arn arn:aws:iam::319951235442:role/defn

    rm -f "$1" "$2"
}

main "$@"
