#!/usr/bin/env bash

if [[ -n "${1:-}" ]]; then
    chdir="$1"; shift
else
    chdir=.
fi

cd "$chdir"

if [[ -n "${1:-}" ]]; then
    eval "$(~/.nix-profile/bin/direnv hook bash)"
    direnv allow
    _direnv_hook
    exec "$@"
else
    if [[ ! -f .envrc ]]; then echo use flake > .envrc; fi
    direnv allow
    code-server .
fi