#!/usr/bin/env bash
# browser - Cross-platform web browser launcher
#
# Usage: browser [url]
#
# Opens a URL in the default web browser. Detects and uses the appropriate
# browser command based on the environment (VSCode, code-server, or native).
# Prevents recursive calls by tracking invocation state.

if [[ -n ${_BROWSER-} ]]; then
	echo "ERROR: browser already called: ${_BROWSER}" 1>&2
	exit 1
fi

export _BROWSER="$0"

function main {
	case "${VSCODE_GIT_ASKPASS_MAIN-}" in
	*code-server*)
		exec "${VSCODE_GIT_ASKPASS_MAIN%%/extensions/*}/bin/helpers/browser.sh" "$@"
		;;
	*/.vscode-server/*)
		exec "${VSCODE_GIT_ASKPASS_MAIN%%/extensions/*}/bin/helpers/browser.sh" "$@"
		;;
	/vscode/*)
		exec "${VSCODE_GIT_ASKPASS_MAIN%%/extensions/*}/bin/helpers/browser.sh" "$@"
		;;
	*)
		if type -P browser.sh >/dev/null; then
			exec browser.sh "$@"
		else
			/bin/open "$@"
		fi
		;;
	esac
}

main "$@"
