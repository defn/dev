#!/usr/bin/env bash
# k - kubectl wrapper with config profile support
#
# Usage: k [profile] [command] [args...]
#        k [profile] x [command] - Execute command with profile's kubeconfig
#
# If profile exists as ~/.kube/config.<profile>, uses that config.
# Otherwise passes all arguments directly to kubectl.
# Use 'x' after profile to execute arbitrary commands with that kubeconfig.

function main {
	if test -r "${HOME}/.kube/config.${1-}"; then
		local config
		config="$1"
		shift

		export KUBECONFIG="${HOME}/.kube/config.${config}"

		case "${1-}" in
		x)
			shift
			exec "$@"
			;;
		*)
			kubectl "$@"
			;;
		esac
	else
		exec kubectl "$@"
	fi
}

main "$@"
