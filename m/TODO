configure .ssh/config
dns resolver, search domain
/etc/netplan/50-cloud-init.yaml:
    dhcp4-overrides:
        use-domains: false
  network:
    wifis:
        wlan0:
ssh host key management

cloud@cloud:~$ cat /etc/netplan/01-netcfg.yaml 
network:
    version: 2
    ethernets:
        ens3:
            addresses:
            - 192.168.249.2/24
            gateway4: 192.168.249.1
            nameservers:
                addresses:
                - 1.1.1.1

sudo netplan apply

sudo iptables -t nat -A POSTROUTING -s 192.168.249.0/24 -o ens3 -j MASQUERADE
sudo iptables -A FORWARD -s 192.168.249.0/24 -o ens3 -j ACCEPT
sudo iptables -A FORWARD -d 192.168.249.0/24 -m state --state RELATED,ESTABLISHED -i ens3 -j ACCEPT

rm -f /tmp/ubuntu-cloudinit.img
mkdosfs -n CIDATA -C /tmp/ubuntu-cloudinit.img 8192
mcopy -oi /tmp/ubuntu-cloudinit.img -s user-data ::
mcopy -oi /tmp/ubuntu-cloudinit.img -s meta-data ::
mcopy -oi /tmp/ubuntu-cloudinit.img -s network-config ::

qemu-img convert -p -f qcow2 -O raw focal-server-cloudimg-amd64.img focal-server-cloudimg-amd64.raw

cloud-hypervisor \
	--kernel ./hypervisor-fw \
	--disk path=focal-server-cloudimg-amd64.raw path=/tmp/ubuntu-cloudinit.img \
	--cpus boot=4 \
	--memory size=1024M \
	--net "tap=,mac=,ip=,mask="

cloud-hypervisor \
	--kernel ./hypervisor-fw \
	--disk path=focal-server-cloudimg-amd64.raw \
	--cpus boot=4 \
	--memory size=1024M \
	--net "tap=,mac=,ip=,mask="

❯ cat meta-data 
instance-id: cloud
local-hostname: cloud

❯ cat user-data 
#cloud-config
ssh_pwauth: True
users:
  - name: cloud
    passwd: $6$7125787751a8d18a$sHwGySomUA1PawiNFWVCKYQN.Ec.Wzz0JtPPL1MvzFrkwmop2dq7.4CYf03A5oemPQ4pOFCCrtCelvFBEle/K.
    sudo: ALL=(ALL) NOPASSWD:ALL
    lock_passwd: False
    inactive: False
    shell: /bin/bash

❯ cat network-config 
version: 2
ethernets:
    ens3:
        addresses:
        - 192.168.249.2/24
        gateway4: 192.168.249.1
        nameservers:
            addresses:
            - 1.1.1.1
