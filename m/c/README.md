# ACUTE - Accumulate, Configure, Unify, Transform, Execute

ACUTE is a configuration and infrastructure management system that uses CUE as a unified source of truth, transforming it to tool-specific formats, and executing tools to generate outputs.

This directory implements a layered CUE configuration system that separates concerns between raw data accumulation, schema-based configuration, unification, transformation, and execution.

## ACUTE Architecture

ACUTE follows a five-phase pipeline:

1. **Accumulate** - Gather raw data from multiple sources (APIs, files, commands)
2. **Configure** - Apply CUE schemas to validate and structure accumulated data
3. **Unify** - Consolidate configured data from all sources into unified CUE
4. **Transform** - Convert CUE to tool/service-specific formats (JSON, YAML, Terraform, etc.)
5. **Execute** - Tools consume transformed formats to generate outputs (docs, infrastructure, deployments)

## Directory Structure

```
c/
├── intention/      # Configure - CUE schemas for validation
├── definition/     # Accumulate - Raw data sources (AWS, repos, etc.)
│   └── accum.sh    # Accumulate - Gather data from repo.yaml
├── application/    # Accumulate - API clients (GitHub repository metadata)
│   └── accum.sh    # Accumulate - Fetch from GitHub API
├── execution/      # Accumulate - Tool outputs (Kustomize, etc.)
│   └── accum.sh    # Accumulate - Gather from kubectl kustomize
├── unify.sh        # Unify - Consolidate accumulated data into CUE with schemas
├── transform.sh    # Transform - Convert CUE to tool-specific formats
├── docs/           # Execute output - Generated Astro.js documentation site
└── README.md       # This file
```

### `intention/` - CUE Schemas
Contains CUE schema definitions that define the structure and constraints for configuration data.

- `repo.cue` - Schema for repository definitions
- `resource.cue` - Schema for Kubernetes resources

These schemas define the intended structure of data without providing actual values.

### `definition/` - Configuration Files
Contains concrete configuration data imported from YAML files.

- `accum.sh` - Accumulates data from `repo.yaml`
- `gen.cue` - Generated CUE output from accum.sh
- `aws/aws.cue` - AWS organization and account definitions
- Provides actual repository definitions with descriptions and metadata

### `execution/` - Tool Configurations
Contains tool-specific configurations and manifests.

- `accum.sh` - Accumulates data from `kubectl kustomize` output
- `gen.cue` - Generated CUE output from accum.sh
- Kustomize configurations for Kubernetes deployments
- Will contain other tool configurations (Terraform, Ansible, etc.)

### `application/` - API Clients
Contains data fetched from external APIs.

- `accum.sh` - Accumulates data from GitHub API
- `gen.cue` - Generated CUE output from accum.sh
- Fetches repository metadata including names, descriptions, URLs, and timestamps

### `docs/` - Documentation Site (Execute Output)
Astro.js + Starlight documentation site built from transformed CUE data. This is an Execute phase output - the site is generated by running Astro.js on JSON files created by `transform.sh`. See [docs/README.md](docs/README.md) for details.

## ACUTE Workflow Scripts

### unify.sh - Unify Accumulated Data

The `unify.sh` script orchestrates the Accumulate, Configure, and Unify phases:

```bash
./unify.sh
```

This runs three accumulation scripts in sequence:

1. **definition/accum.sh** - Accumulates raw data from `repo.yaml`
2. **execution/accum.sh** - Accumulates raw data from kustomize output
3. **application/accum.sh** - Accumulates raw data from GitHub API

Each `accum.sh` script gathers raw data and generates CUE files. Then `unify.sh`:
- Applies CUE schemas from `intention/` (Configure phase)
- Validates and unifies all data sources (Unify phase)
- Exports to YAML format

### transform.sh - Transform to Tool-Specific Formats

The `transform.sh` script transforms unified CUE data into tool-specific formats:

```bash
./transform.sh
```

This will:
- Convert CUE data to JSON format for Astro.js documentation
- Generate files for `docs/src/content/` collections
- Create AWS account JSON from `definition/aws/aws.cue`
- (Future) Generate Terraform configurations, Ansible playbooks, etc.

These transformed formats are then consumed by tools in the Execute phase.

## Unification Model

The `main.cue` file imports all four packages and unifies them:

```cue
config: {
    resource: intention.resource  // Schema definition
    resource: execution.resource  // Actual resources (unified with schema)

    repo: intention.repo          // Schema definition
    repo: definition.repo         // Configuration data
    repo: application.repo        // API data (unified with schema and config)
}
```

CUE's unification ensures that:
- All `definition` data conforms to `intention` schemas
- All `execution` resources match `intention` schemas
- All `application` data is validated against `intention` schemas
- Conflicts between layers are detected at evaluation time

## Getting Started

1. **Unify data sources:**
   ```bash
   ./unify.sh
   ```
   This imports all data into CUE format and validates against schemas.

2. **Transform to tool-specific formats:**
   ```bash
   ./transform.sh
   ```
   This generates tool-specific files (JSON for Astro.js, etc.) from CUE data.

3. **Execute tools to generate outputs:**
   ```bash
   cd docs
   npm install  # First time only
   npm run dev
   ```
   This runs Astro.js to build the documentation site from transformed JSON.

   Visit the docs site to browse AWS accounts, configurations, and infrastructure details.

## Development Workflow

1. **Accumulate**: Gather raw data from various sources
   - Each subdirectory has `accum.sh` to collect data (YAML files, APIs, commands)
   - Raw data is converted to CUE format without validation

2. **Configure**: Define schemas and validate
   - Schemas defined in `intention/` describe expected structure
   - CUE automatically applies schemas during unification

3. **Unify**: Run `./unify.sh` to consolidate and validate
   - Calls all `accum.sh` scripts to gather raw data
   - Applies schemas to validate accumulated data
   - Unifies all data sources into single CUE structure

4. **Transform**: Run `./transform.sh` to convert CUE to tool-specific formats
   - Generates JSON for Astro.js documentation
   - (Future) Creates Terraform configs, Ansible playbooks, etc.

5. **Execute**: Run tools to generate final outputs
   - Build documentation site with `cd docs && npm run build`
   - Deploy infrastructure with `kubectl apply -k execution/`
   - (Future) Run Terraform, Ansible, etc.

This approach uses CUE as a single source of truth while supporting multiple tool ecosystems through format transformation.
