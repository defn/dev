# ACUTE - Agent, Config, Unify, Transform, Execute

ACUTE is a configuration and infrastructure management system that uses CUE as a unified source of truth, transforming it to tool-specific formats, and executing tools to generate outputs.

This directory implements a layered CUE configuration system that separates concerns between schemas, configurations, build artifacts, and API data.

## ACUTE Architecture

ACUTE follows a five-phase pipeline:

1. **Agent** - AI-assisted configuration management
2. **Config** - CUE-based configuration definitions
3. **Unify** - Consolidate data from multiple sources into CUE
4. **Transform** - Convert CUE to tool/service-specific formats (JSON, YAML, Terraform, etc.)
5. **Execute** - Run tools to generate outputs (documentation sites, infrastructure, deployments)

## Directory Structure

```
c/
├── agent/          # Agent - AI configurations and prompts
├── definition/     # Config - CUE configuration definitions (AWS, etc.)
├── intention/      # Config - CUE schemas for validation
├── application/    # Unify - API clients (GitHub repository metadata)
├── unify.sh        # Unify - Consolidate data from sources into CUE
├── transform.sh    # Transform - Convert CUE to tool-specific formats
├── execution/      # Execute - Tool configurations (Kustomize, etc.)
├── docs/           # Execute output - Generated Astro.js documentation site
└── README.md       # This file
```

### `intention/` - CUE Schemas
Contains CUE schema definitions that define the structure and constraints for configuration data.

- `repo.cue` - Schema for repository definitions
- `resource.cue` - Schema for Kubernetes resources

These schemas define the intended structure of data without providing actual values.

### `definition/` - Configuration Files
Contains concrete configuration data imported from YAML files.

- `gen.cue` - Generated from `repo.yaml` via ingestion scripts
- `aws/aws.cue` - AWS organization and account definitions
- Provides actual repository definitions with descriptions and metadata

### `execution/` - Tool Configurations
Contains tool-specific configurations and manifests.

- `gen.cue` - Generated from `kubectl kustomize` output via `ingest-kustomize.sh`
- Kustomize configurations for Kubernetes deployments
- Will contain other tool configurations (Terraform, Ansible, etc.)

### `application/` - API Clients
Contains data fetched from external APIs.

- `gen.cue` - Generated from GitHub API via `ingest-github-repo.sh`
- Fetches repository metadata including names, descriptions, URLs, and timestamps

### `docs/` - Documentation Site (Execute Output)
Astro.js + Starlight documentation site built from transformed CUE data. This is an Execute phase output - the site is generated by running Astro.js on JSON files created by `transform.sh`. See [docs/README.md](docs/README.md) for details.

## ACUTE Workflow Scripts

### unify.sh - Unify Data Sources

The `unify.sh` script orchestrates data ingestion across all layers, transforming external data sources into importable CUE packages:

```bash
./unify.sh
```

This runs three ingestion scripts in sequence:

1. **definition/ingest-repo.sh** - Converts `repo.yaml` to CUE format
2. **execution/ingest-kustomize.sh** - Converts kustomize output to CUE format
3. **application/ingest-github-repo.sh** - Fetches GitHub repo data and converts to CUE

Each ingestion script transforms data (YAML files, command output, or API responses) into properly formatted CUE packages that can be imported and unified with the schema definitions.

After ingestion, it runs `cue eval` to unify all layers and exports to YAML.

### transform.sh - Transform to Tool-Specific Formats

The `transform.sh` script transforms unified CUE data into tool-specific formats:

```bash
./transform.sh
```

This will:
- Convert CUE data to JSON format for Astro.js documentation
- Generate files for `docs/src/content/` collections
- Create AWS account JSON from `definition/aws/aws.cue`
- (Future) Generate Terraform configurations, Ansible playbooks, etc.

These transformed formats are then consumed by tools in the Execute phase.

## Unification Model

The `main.cue` file imports all four packages and unifies them:

```cue
config: {
    resource: intention.resource  // Schema definition
    resource: execution.resource  // Actual resources (unified with schema)

    repo: intention.repo          // Schema definition
    repo: definition.repo         // Configuration data
    repo: application.repo        // API data (unified with schema and config)
}
```

CUE's unification ensures that:
- All `definition` data conforms to `intention` schemas
- All `execution` resources match `intention` schemas
- All `application` data is validated against `intention` schemas
- Conflicts between layers are detected at evaluation time

## Getting Started

1. **Unify data sources:**
   ```bash
   ./unify.sh
   ```
   This imports all data into CUE format and validates against schemas.

2. **Transform to tool-specific formats:**
   ```bash
   ./transform.sh
   ```
   This generates tool-specific files (JSON for Astro.js, etc.) from CUE data.

3. **Execute tools to generate outputs:**
   ```bash
   cd docs
   npm install  # First time only
   npm run dev
   ```
   This runs Astro.js to build the documentation site from transformed JSON.

   Visit the docs site to browse AWS accounts, configurations, and infrastructure details.

## Development Workflow

1. **Agent**: Use AI to assist with configuration management and updates
2. **Config**: Define schemas in `intention/` and configurations in `definition/`
3. **Unify**: Run `./unify.sh` to consolidate data from multiple sources into CUE
   - Imports configuration files, API data, and existing tool outputs
   - Validates and unifies all data against schemas
4. **Transform**: Run `./transform.sh` to convert CUE to tool-specific formats
   - Generates JSON for Astro.js documentation
   - (Future) Creates Terraform configs, Ansible playbooks, etc.
5. **Execute**: Run tools to generate final outputs
   - Build documentation site with `cd docs && npm run build`
   - Deploy infrastructure with `kubectl apply -k execution/`
   - (Future) Run Terraform, Ansible, etc.

This approach uses CUE as a single source of truth while supporting multiple tool ecosystems through format transformation.
