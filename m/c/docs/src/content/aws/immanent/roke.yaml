# auto-generated: transform.sh
account: roke
email: immanent-roke@defn.us
id: "892560628624"
name: immanent-roke
org: immanent
sso_role: Administrator
aws_config: |-
  # auto-generated: aws.cue aws_config_account
  [profile immanent-roke]
  sso_account_id=892560628624
  sso_role_name=Administrator
  sso_start_url=https://immanent-0.awsapps.com/start
  sso_region=us-west-2

  # auto-generated: aws.cue aws_config_bootstrap
  [profile defn-org]
  sso_account_id=510430971399
  sso_role_name=Administrator
  sso_start_url=https://defn.awsapps.com/start
  sso_region=us-east-2
mise_config: |-
  # auto-generated: aws.cue mise_config
  [env]
  AWS_PROFILE = "immanent-roke"
  AWS_REGION = "us-west-2"
  AWS_CONFIG_FILE = "/home/ubuntu/m/aws/immanent/roke/.aws/config"
aws_config_account: |-
  # auto-generated: aws.cue aws_config_account
  [profile immanent-roke]
  sso_account_id=892560628624
  sso_role_name=Administrator
  sso_start_url=https://immanent-0.awsapps.com/start
  sso_region=us-west-2
aws_config_bootstrap: |-
  # auto-generated: aws.cue aws_config_bootstrap
  [profile defn-org]
  sso_account_id=510430971399
  sso_role_name=Administrator
  sso_start_url=https://defn.awsapps.com/start
  sso_region=us-east-2
account_readme: |-
  ## AWS Environment: immanent-roke

  ```bash
  cd aws/immanent/roke
  mise trust
  aws sso login
  alogin
  ```

  auto-generated: aws.cue account_readme
infra_org_readme: |-
  ## Organizational-level Terraform: immanent-roke

  ```bash
  cd infra/org-immanent
  mise trust
  aws sso login
  terraform init
  terraform plan
  ```

  auto-generated: aws.cue infra_org_readme
infra_acc_readme: |-
  ## Account-specific Terraform: immanent-roke

  ```bash
  cd infra/acc-immanent-roke
  mise trust
  aws sso login --profile defn-org
  aws sso login
  terraform init
  terraform plan
  ```

  auto-generated: aws.cue infra_acc_readme
infra_acc_terraform: |-
  # auto-generated: aws.cue infra_acc_terraform
  terraform {
    required_providers {
      aws = {
        version = "5.99.1"
        source  = "aws"
      }
    }
    backend "s3" {
      bucket         = "dfn-defn-terraform-state"
  	use_lockfile   = true
      encrypt        = true
      key            = "stacks/acc-immanent-roke/terraform.tfstate"
      profile        = "defn-org"
      region         = "us-east-1"
    }
  }

  variable "config" {}

  provider "aws" {
    profile = "immanent-roke"
    alias   = "immanent-roke"
    region  = "us-east-1"
  }

  data "aws_caller_identity" "current" {
  	provider = aws.immanent-roke
  }

  locals {
    aws_config = jsonencode({
  	"immanent-roke": {
  		account_id = data.aws_caller_identity.current.account_id
  	}
    })
  }

  output "aws_config" {
    value = local.aws_config
  }

  output "auditor_arn" {
    value = module.immanent-roke.auditor_arn
  }

  module "immanent-roke" {
    account   = 510430971399
    name      = "terraform"
    namespace = "immanent"
    stage     = "ops"
    source    = "./mod/terraform-aws-defn-account"
    providers = {
      aws = aws.immanent-roke
    }

    config = var.config
  }
