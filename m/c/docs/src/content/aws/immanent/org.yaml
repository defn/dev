# auto-generated: transform.sh
id: "545070380609"
account: org
org: immanent
name: immanent-org
email: aws-immanent@defn.us
sso_role: Administrator
aws_config: |-
  # auto-generated: aws.cue aws_config_account
  [profile immanent-org]
  sso_account_id=545070380609
  sso_role_name=Administrator
  sso_start_url=https://immanent-0.awsapps.com/start
  sso_region=us-west-2

  # auto-generated: aws.cue aws_config_bootstrap
  [profile defn-org]
  sso_account_id=510430971399
  sso_role_name=Administrator
  sso_start_url=https://defn.awsapps.com/start
  sso_region=us-east-2
mise_config: |-
  # auto-generated: aws.cue mise_config
  [env]
  AWS_PROFILE = "immanent-org"
  AWS_REGION = "us-west-2"
  AWS_CONFIG_FILE = "/home/ubuntu/m/a/immanent/org/.aws/config"
aws_config_account: |-
  # auto-generated: aws.cue aws_config_account
  [profile immanent-org]
  sso_account_id=545070380609
  sso_role_name=Administrator
  sso_start_url=https://immanent-0.awsapps.com/start
  sso_region=us-west-2
aws_config_bootstrap: |-
  # auto-generated: aws.cue aws_config_bootstrap
  [profile defn-org]
  sso_account_id=510430971399
  sso_role_name=Administrator
  sso_start_url=https://defn.awsapps.com/start
  sso_region=us-east-2
account_readme: |-
  ## AWS Environment: immanent-org

  ```bash
  cd a/immanent/org
  mise trust
  aws sso login
  alogin
  ```

  auto-generated: aws.cue account_readme
infra_org_readme: |-
  ## Organizational-level Terraform: immanent-org

  ```bash
  cd infra/org-immanent
  mise trust
  aws sso login
  terraform init
  terraform plan
  ```

  auto-generated: aws.cue infra_org_readme
infra_org_terraform: |-
  terraform {
    required_providers {
      aws = {
        version = "5.99.1"
        source  = "aws"
      }
    }
    backend "s3" {
      bucket         = "dfn-defn-terraform-state"
      dynamodb_table = "dfn-defn-terraform-state-lock"
      encrypt        = true
      key            = "stacks/org-immanent/terraform.tfstate"
      profile        = "defn-org"
      region         = "us-east-1"
    }

  }

  locals {
    sso_instance_arn  = data.aws_ssoadmin_instances.sso_instance.arns
    sso_instance_isid = data.aws_ssoadmin_instances.sso_instance.identity_store_ids
  }

  provider "aws" {
    profile = "immanent-org"
    region  = "us-west-2"
  }

  resource "aws_organizations_organization" "organization" {
    aws_service_access_principals = [
      "account.amazonaws.com",
      "iam.amazonaws.com",
      "cloudtrail.amazonaws.com",
      "config.amazonaws.com",
      "ram.amazonaws.com",
      "ssm.amazonaws.com",
      "sso.amazonaws.com",
      "tagpolicies.tag.amazonaws.com"
    ]
    enabled_policy_types = [
      "SERVICE_CONTROL_POLICY",
      "TAG_POLICY"
    ]
    feature_set = "ALL"
  }

  data "aws_ssoadmin_instances" "sso_instance" {
  }

  resource "aws_ssoadmin_permission_set" "admin_sso_permission_set" {
    instance_arn     = element(local.sso_instance_arn, 0)
    name             = "Administrator"
    session_duration = "PT2H"
    tags = {
      ManagedBy = "Terraform"
    }
  }

  resource "aws_ssoadmin_managed_policy_attachment" "admin_sso_managed_policy_attachment" {
    instance_arn       = aws_ssoadmin_permission_set.admin_sso_permission_set.instance_arn
    managed_policy_arn = "arn:aws:iam::aws:policy/AdministratorAccess"
    permission_set_arn = aws_ssoadmin_permission_set.admin_sso_permission_set.arn
  }

  resource "aws_identitystore_group" "administrators_sso_group" {
    display_name      = "Administrators"
    identity_store_id = element(local.sso_instance_isid, 0)
  }
  resource "aws_organizations_account" "immanent_org" {
    email = "aws-immanent@defn.us"
    name  = "immanent-org"
    tags = {
      ManagedBy = "Terraform"
    }
  }

  resource "aws_ssoadmin_account_assignment" "immanent_org_admin_sso_account_assignment" {
    instance_arn       = aws_ssoadmin_managed_policy_attachment.admin_sso_managed_policy_attachment.instance_arn
    permission_set_arn = aws_ssoadmin_managed_policy_attachment.admin_sso_managed_policy_attachment.permission_set_arn
    principal_id       = aws_identitystore_group.administrators_sso_group.group_id
    principal_type     = "GROUP"
    target_id          = aws_organizations_account.immanent_org.id
    target_type        = "AWS_ACCOUNT"
  }
  resource "aws_organizations_account" "immanent_changer" {
    email = "immanent-changer@defn.us"
    name  = "immanent-changer"
    tags = {
      ManagedBy = "Terraform"
    }
  }

  resource "aws_ssoadmin_account_assignment" "immanent_changer_admin_sso_account_assignment" {
    instance_arn       = aws_ssoadmin_managed_policy_attachment.admin_sso_managed_policy_attachment.instance_arn
    permission_set_arn = aws_ssoadmin_managed_policy_attachment.admin_sso_managed_policy_attachment.permission_set_arn
    principal_id       = aws_identitystore_group.administrators_sso_group.group_id
    principal_type     = "GROUP"
    target_id          = aws_organizations_account.immanent_changer.id
    target_type        = "AWS_ACCOUNT"
  }
  resource "aws_organizations_account" "immanent_chanter" {
    email = "immanent-chanter@defn.us"
    name  = "immanent-chanter"
    tags = {
      ManagedBy = "Terraform"
    }
  }

  resource "aws_ssoadmin_account_assignment" "immanent_chanter_admin_sso_account_assignment" {
    instance_arn       = aws_ssoadmin_managed_policy_attachment.admin_sso_managed_policy_attachment.instance_arn
    permission_set_arn = aws_ssoadmin_managed_policy_attachment.admin_sso_managed_policy_attachment.permission_set_arn
    principal_id       = aws_identitystore_group.administrators_sso_group.group_id
    principal_type     = "GROUP"
    target_id          = aws_organizations_account.immanent_chanter.id
    target_type        = "AWS_ACCOUNT"
  }
  resource "aws_organizations_account" "immanent_doorkeeper" {
    email = "immanent-doorkeeper@defn.us"
    name  = "immanent-doorkeeper"
    tags = {
      ManagedBy = "Terraform"
    }
  }

  resource "aws_ssoadmin_account_assignment" "immanent_doorkeeper_admin_sso_account_assignment" {
    instance_arn       = aws_ssoadmin_managed_policy_attachment.admin_sso_managed_policy_attachment.instance_arn
    permission_set_arn = aws_ssoadmin_managed_policy_attachment.admin_sso_managed_policy_attachment.permission_set_arn
    principal_id       = aws_identitystore_group.administrators_sso_group.group_id
    principal_type     = "GROUP"
    target_id          = aws_organizations_account.immanent_doorkeeper.id
    target_type        = "AWS_ACCOUNT"
  }
  resource "aws_organizations_account" "immanent_ged" {
    email = "immanent-ged@defn.us"
    name  = "immanent-ged"
    tags = {
      ManagedBy = "Terraform"
    }
  }

  resource "aws_ssoadmin_account_assignment" "immanent_ged_admin_sso_account_assignment" {
    instance_arn       = aws_ssoadmin_managed_policy_attachment.admin_sso_managed_policy_attachment.instance_arn
    permission_set_arn = aws_ssoadmin_managed_policy_attachment.admin_sso_managed_policy_attachment.permission_set_arn
    principal_id       = aws_identitystore_group.administrators_sso_group.group_id
    principal_type     = "GROUP"
    target_id          = aws_organizations_account.immanent_ged.id
    target_type        = "AWS_ACCOUNT"
  }
  resource "aws_organizations_account" "immanent_hand" {
    email = "immanent-hand@defn.us"
    name  = "immanent-hand"
    tags = {
      ManagedBy = "Terraform"
    }
  }

  resource "aws_ssoadmin_account_assignment" "immanent_hand_admin_sso_account_assignment" {
    instance_arn       = aws_ssoadmin_managed_policy_attachment.admin_sso_managed_policy_attachment.instance_arn
    permission_set_arn = aws_ssoadmin_managed_policy_attachment.admin_sso_managed_policy_attachment.permission_set_arn
    principal_id       = aws_identitystore_group.administrators_sso_group.group_id
    principal_type     = "GROUP"
    target_id          = aws_organizations_account.immanent_hand.id
    target_type        = "AWS_ACCOUNT"
  }
  resource "aws_organizations_account" "immanent_herbal" {
    email = "immanent-herbal@defn.us"
    name  = "immanent-herbal"
    tags = {
      ManagedBy = "Terraform"
    }
  }

  resource "aws_ssoadmin_account_assignment" "immanent_herbal_admin_sso_account_assignment" {
    instance_arn       = aws_ssoadmin_managed_policy_attachment.admin_sso_managed_policy_attachment.instance_arn
    permission_set_arn = aws_ssoadmin_managed_policy_attachment.admin_sso_managed_policy_attachment.permission_set_arn
    principal_id       = aws_identitystore_group.administrators_sso_group.group_id
    principal_type     = "GROUP"
    target_id          = aws_organizations_account.immanent_herbal.id
    target_type        = "AWS_ACCOUNT"
  }
  resource "aws_organizations_account" "immanent_namer" {
    email = "immanent-namer@defn.us"
    name  = "immanent-namer"
    tags = {
      ManagedBy = "Terraform"
    }
  }

  resource "aws_ssoadmin_account_assignment" "immanent_namer_admin_sso_account_assignment" {
    instance_arn       = aws_ssoadmin_managed_policy_attachment.admin_sso_managed_policy_attachment.instance_arn
    permission_set_arn = aws_ssoadmin_managed_policy_attachment.admin_sso_managed_policy_attachment.permission_set_arn
    principal_id       = aws_identitystore_group.administrators_sso_group.group_id
    principal_type     = "GROUP"
    target_id          = aws_organizations_account.immanent_namer.id
    target_type        = "AWS_ACCOUNT"
  }
  resource "aws_organizations_account" "immanent_patterner" {
    email = "immanent-patterner@defn.us"
    name  = "immanent-patterner"
    tags = {
      ManagedBy = "Terraform"
    }
  }

  resource "aws_ssoadmin_account_assignment" "immanent_patterner_admin_sso_account_assignment" {
    instance_arn       = aws_ssoadmin_managed_policy_attachment.admin_sso_managed_policy_attachment.instance_arn
    permission_set_arn = aws_ssoadmin_managed_policy_attachment.admin_sso_managed_policy_attachment.permission_set_arn
    principal_id       = aws_identitystore_group.administrators_sso_group.group_id
    principal_type     = "GROUP"
    target_id          = aws_organizations_account.immanent_patterner.id
    target_type        = "AWS_ACCOUNT"
  }
  resource "aws_organizations_account" "immanent_roke" {
    email = "immanent-roke@defn.us"
    name  = "immanent-roke"
    tags = {
      ManagedBy = "Terraform"
    }
  }

  resource "aws_ssoadmin_account_assignment" "immanent_roke_admin_sso_account_assignment" {
    instance_arn       = aws_ssoadmin_managed_policy_attachment.admin_sso_managed_policy_attachment.instance_arn
    permission_set_arn = aws_ssoadmin_managed_policy_attachment.admin_sso_managed_policy_attachment.permission_set_arn
    principal_id       = aws_identitystore_group.administrators_sso_group.group_id
    principal_type     = "GROUP"
    target_id          = aws_organizations_account.immanent_roke.id
    target_type        = "AWS_ACCOUNT"
  }
  resource "aws_organizations_account" "immanent_summoner" {
    email = "immanent-summoner@defn.us"
    name  = "immanent-summoner"
    tags = {
      ManagedBy = "Terraform"
    }
  }

  resource "aws_ssoadmin_account_assignment" "immanent_summoner_admin_sso_account_assignment" {
    instance_arn       = aws_ssoadmin_managed_policy_attachment.admin_sso_managed_policy_attachment.instance_arn
    permission_set_arn = aws_ssoadmin_managed_policy_attachment.admin_sso_managed_policy_attachment.permission_set_arn
    principal_id       = aws_identitystore_group.administrators_sso_group.group_id
    principal_type     = "GROUP"
    target_id          = aws_organizations_account.immanent_summoner.id
    target_type        = "AWS_ACCOUNT"
  }
  resource "aws_organizations_account" "immanent_windkey" {
    email = "immanent-windkey@defn.us"
    name  = "immanent-windkey"
    tags = {
      ManagedBy = "Terraform"
    }
  }

  resource "aws_ssoadmin_account_assignment" "immanent_windkey_admin_sso_account_assignment" {
    instance_arn       = aws_ssoadmin_managed_policy_attachment.admin_sso_managed_policy_attachment.instance_arn
    permission_set_arn = aws_ssoadmin_managed_policy_attachment.admin_sso_managed_policy_attachment.permission_set_arn
    principal_id       = aws_identitystore_group.administrators_sso_group.group_id
    principal_type     = "GROUP"
    target_id          = aws_organizations_account.immanent_windkey.id
    target_type        = "AWS_ACCOUNT"
  }
  moved {
    from = aws_organizations_account.immanent-org
    to   = aws_organizations_account.immanent_org
  }
  moved {
    from = aws_organizations_account.immanent-changer
    to   = aws_organizations_account.immanent_changer
  }
  moved {
    from = aws_organizations_account.immanent-chanter
    to   = aws_organizations_account.immanent_chanter
  }
  moved {
    from = aws_organizations_account.immanent-doorkeeper
    to   = aws_organizations_account.immanent_doorkeeper
  }
  moved {
    from = aws_organizations_account.immanent-ged
    to   = aws_organizations_account.immanent_ged
  }
  moved {
    from = aws_organizations_account.immanent-hand
    to   = aws_organizations_account.immanent_hand
  }
  moved {
    from = aws_organizations_account.immanent-herbal
    to   = aws_organizations_account.immanent_herbal
  }
  moved {
    from = aws_organizations_account.immanent-namer
    to   = aws_organizations_account.immanent_namer
  }
  moved {
    from = aws_organizations_account.immanent-patterner
    to   = aws_organizations_account.immanent_patterner
  }
  moved {
    from = aws_organizations_account.immanent-roke
    to   = aws_organizations_account.immanent_roke
  }
  moved {
    from = aws_organizations_account.immanent-summoner
    to   = aws_organizations_account.immanent_summoner
  }
  moved {
    from = aws_organizations_account.immanent-windkey
    to   = aws_organizations_account.immanent_windkey
  }
  moved {
    from = aws_ssoadmin_account_assignment.immanent-org_admin_sso_account_assignment
    to   = aws_ssoadmin_account_assignment.immanent_org_admin_sso_account_assignment
  }
  moved {
    from = aws_ssoadmin_account_assignment.immanent-changer_admin_sso_account_assignment
    to   = aws_ssoadmin_account_assignment.immanent_changer_admin_sso_account_assignment
  }
  moved {
    from = aws_ssoadmin_account_assignment.immanent-chanter_admin_sso_account_assignment
    to   = aws_ssoadmin_account_assignment.immanent_chanter_admin_sso_account_assignment
  }
  moved {
    from = aws_ssoadmin_account_assignment.immanent-doorkeeper_admin_sso_account_assignment
    to   = aws_ssoadmin_account_assignment.immanent_doorkeeper_admin_sso_account_assignment
  }
  moved {
    from = aws_ssoadmin_account_assignment.immanent-ged_admin_sso_account_assignment
    to   = aws_ssoadmin_account_assignment.immanent_ged_admin_sso_account_assignment
  }
  moved {
    from = aws_ssoadmin_account_assignment.immanent-hand_admin_sso_account_assignment
    to   = aws_ssoadmin_account_assignment.immanent_hand_admin_sso_account_assignment
  }
  moved {
    from = aws_ssoadmin_account_assignment.immanent-herbal_admin_sso_account_assignment
    to   = aws_ssoadmin_account_assignment.immanent_herbal_admin_sso_account_assignment
  }
  moved {
    from = aws_ssoadmin_account_assignment.immanent-namer_admin_sso_account_assignment
    to   = aws_ssoadmin_account_assignment.immanent_namer_admin_sso_account_assignment
  }
  moved {
    from = aws_ssoadmin_account_assignment.immanent-patterner_admin_sso_account_assignment
    to   = aws_ssoadmin_account_assignment.immanent_patterner_admin_sso_account_assignment
  }
  moved {
    from = aws_ssoadmin_account_assignment.immanent-roke_admin_sso_account_assignment
    to   = aws_ssoadmin_account_assignment.immanent_roke_admin_sso_account_assignment
  }
  moved {
    from = aws_ssoadmin_account_assignment.immanent-summoner_admin_sso_account_assignment
    to   = aws_ssoadmin_account_assignment.immanent_summoner_admin_sso_account_assignment
  }
  moved {
    from = aws_ssoadmin_account_assignment.immanent-windkey_admin_sso_account_assignment
    to   = aws_ssoadmin_account_assignment.immanent_windkey_admin_sso_account_assignment
  }
infra_acc_readme: |-
  ## Account-specific Terraform: immanent-org

  ```bash
  cd infra/acc-immanent-org
  mise trust
  aws sso login --profile defn-org
  aws sso login
  terraform init
  terraform plan
  ```

  auto-generated: aws.cue infra_acc_readme
infra_acc_terraform: |-
  terraform {
    required_providers {
      aws = {
        version = "5.99.1"
        source  = "aws"
      }
    }
    backend "s3" {
      bucket         = "dfn-defn-terraform-state"
      dynamodb_table = "dfn-defn-terraform-state-lock"
      encrypt        = true
      key            = "stacks/acc-immanent-org/terraform.tfstate"
      profile        = "defn-org"
      region         = "us-east-1"
    }

  }

  provider "aws" {
    profile = "immanent-org"
    region  = "us-east-1"
    alias   = "immanent-org"
  }

  module "immanent-org" {
    account   = 510430971399
    name      = "terraform"
    namespace = "immanent"
    stage     = "ops"
    source    = "./mod/terraform-aws-defn-account"
    providers = {
      aws = aws.immanent-org
    }
  }
