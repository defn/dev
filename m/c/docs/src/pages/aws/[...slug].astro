---
import { getCollection } from 'astro:content';
import StarlightPage from '@astrojs/starlight/components/StarlightPage.astro';

export async function getStaticPaths() {
  const awsAccounts = await getCollection('aws');
  return awsAccounts.map((account) => ({
    params: { slug: account.id },
    props: { account },
  }));
}

const { account } = Astro.props;
const { name, account: accountName, org, id, email, sso_role, aws_config_account } = account.data;
const profileName = `${org}-${accountName}`;
---

<StarlightPage frontmatter={{
  title: `AWS Account: ${org}/${accountName}`,
  description: `Details for ${org}/${accountName} AWS account`
}}>
  <div style="margin-bottom: 2rem;">
    <a href="../../">‚Üê Back to all AWS accounts</a>
  </div>

  <h2>Account Details</h2>

  <dl style="display: grid; grid-template-columns: max-content 1fr; gap: 0.5rem 1rem; margin-top: 1rem;">
    <dt style="font-weight: bold;">Name:</dt>
    <dd>{name}</dd>

    <dt style="font-weight: bold;">Organization:</dt>
    <dd>{org}</dd>

    <dt style="font-weight: bold;">Account:</dt>
    <dd>{accountName}</dd>

    <dt style="font-weight: bold;">Account ID:</dt>
    <dd><code>{id}</code></dd>

    <dt style="font-weight: bold;">Email:</dt>
    <dd>{email}</dd>

    <dt style="font-weight: bold;">SSO Role:</dt>
    <dd>{sso_role}</dd>
  </dl>

  {aws_config_account && (
    <div style="margin-top: 2rem;">
      <h3>AWS Configuration</h3>
      <p>Add this to your <code>~/.aws/config</code> file:</p>
      <pre style="margin-top: 1rem; padding: 1rem; background: var(--sl-color-gray-6); border-radius: 0.5rem; overflow-x: auto;"><code>{aws_config_account}</code></pre>
      <p style="margin-top: 1rem;">Then set the profile environment variable:</p>
      <pre style="margin-top: 0.5rem; padding: 1rem; background: var(--sl-color-gray-6); border-radius: 0.5rem; overflow-x: auto;"><code>export AWS_PROFILE={profileName}</code></pre>
    </div>
  )}
</StarlightPage>
