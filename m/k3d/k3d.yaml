apiVersion: k3d.io/v1alpha5
kind: Simple
metadata:
  name: defnxxx
servers: 1
agents: 0
kubeAPI:
  host: "defn.xxx"
  hostIP: "169.254.32.1"
  hostPort: "6443"
ports:
  - port: 169.254.32.1:80:80
    nodeFilters:
      - loadbalancer
  - port: 169.254.32.1:443:443
    nodeFilters:
      - loadbalancer
volumes:
  - volume: ${PWD}/k3d-admin.yaml:/var/lib/rancher/k3s/server/manifests/k3d-admin.yaml
    nodeFilters:
      - server:*
  - volume: ${PWD}/k3d-argocd.yaml:/var/lib/rancher/k3s/server/manifests/k3d-argocd.yaml
    nodeFilters:
      - server:*
  - volume: ${PWD}/k3d-ingress.yaml:/var/lib/rancher/k3s/server/manifests/k3d-ingress.yaml
    nodeFilters:
      - server:*
registries:
  config: |
    mirrors:
      "docker.io":
        endpoint:
          - "http://169.254.32.1:5000"
      "registry-1.docker.io":
        endpoint:
          - "http://169.254.32.1:5000"
      "ghcr.io":
        endpoint:
          - "http://169.254.32.1:5000"
      "quay.io":
        endpoint:
          - "http://169.254.32.1:5000"
      "gcr.io":
        endpoint:
          - "http://169.254.32.1:5000"
      "registry.k8s.io":
        endpoint:
          - "http://169.254.32.1:5000"
      "*":
        endpoint:
          - "http://169.254.32.1:5000"
    configs:
      "169.254.32.1:5000":
        tls:
          insecure_skip_verify: true
options:
  k3s:
    extraArgs:
      - arg: "--tls-san=defn.xxx"
        nodeFilters:
          - server:*
      - arg: "--tls-san=169.254.32.1"
        nodeFilters:
          - server:*
