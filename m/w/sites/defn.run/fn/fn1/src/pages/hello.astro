---
import Layout from "../layouts/Layout.astro";
import UI from "../components/UI.svelte";
import Counter from "../components/Counter.svelte";
import Button from "../components/Button.astro";

import { library, icon } from "@fortawesome/fontawesome-svg-core";
import * as fa from "@fortawesome/free-solid-svg-icons";

const ic = new Map();
for (let f of [fa.faEnvelope, fa.faGamepad]) {
  library.add(f);
  ic.set(f.iconName, icon({ prefix: "fas", iconName: f.iconName }).html);
}

const kv = Astro.locals.runtime.env.kv;
var kv_value = parseFloat(await kv.get("key"));
if (isNaN(kv_value)) {
  kv_value = 1;
}
await kv.put("key", kv_value + 1);

const bucket = Astro.locals.runtime.env.bucket;
var key_value = await bucket.get("key");
var r2_value = "new";
if (key_value !== null) {
  r2_value = await key_value.text();
}
await bucket.put("key", `${kv_value}:${Math.floor(Date.now() / 1000)}`);
---

<Layout>
  <UI>
    <div>
      {
        Array.from(ic.entries()).map(([key, value]) => (
          <span class="m-5">
            <Fragment set:html={value} />
          </span>
        ))
      }
    </div>

    <Button>
      <div>kv_value: {kv_value}</div>
      <div>r2_value: {r2_value}</div>
    </Button>

    <Counter client:visible />
  </UI>
</Layout>
