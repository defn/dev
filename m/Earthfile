VERSION 0.7

build:
    FROM quay.io/defn/dev:latest-nix-installed
    ENTRYPOINT ["/home/ubuntu/.nix-profile/bin/nix", "develop", "--command", "bash", "-c"]
    CMD ["bash -il"]
    RUN /home/ubuntu/.nix-profile/bin/nix registry pin flake:nixpkgs
    RUN echo source $HOME/.nix-profile/share/nix-direnv/direnvrc > /home/ubuntu/.direnvrc
    RUN echo export DIRENV_LOG_FORMAT= >> /home/ubuntu/.bashrc
    RUN echo export DIRENV_WARN_TIMEOUT=300s >> /home/ubuntu/.bashrc
    RUN git init && git config --global user.email "you@example.com" && git config --global user.name "Your Name"
    RUN mkdir -p /nix/cache /nix/cache/cache && rm -rf /home/ubuntu/.cache && ln -nfs /nix/cache/cache /home/ubuntu/.cache
    COPY . .
    RUN git add . && git commit -m "initial commit"
    RUN direnv allow
    SAVE IMAGE meh
