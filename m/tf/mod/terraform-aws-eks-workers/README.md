<!-- markdownlint-disable -->

# terraform-aws-eks-workers <a href="https://cpco.io/homepage?utm_source=github&utm_medium=readme&utm_campaign=cloudposse/terraform-aws-eks-workers&utm_content="><img align="right" src="https://cloudposse.com/logo-300x69.svg" width="150" /></a>

<a href="https://github.com/cloudposse/terraform-aws-eks-workers/releases/latest"><img src="https://img.shields.io/github/release/cloudposse/terraform-aws-eks-workers.svg" alt="Latest Release"/></a><a href="https://slack.cloudposse.com"><img src="https://slack.cloudposse.com/badge.svg" alt="Slack Community"/></a>

<!-- markdownlint-restore -->

<!--




  ** DO NOT EDIT THIS FILE
  **
  ** This file was automatically generated by the `cloudposse/build-harness`.
  ** 1) Make all changes to `README.yaml`
  ** 2) Run `make init` (you only need to do this once)
  ** 3) Run`make readme` to rebuild this file.
  **
  ** (We maintain HUNDREDS of open source projects. This is how we maintain our sanity.)
  **





-->

Terraform module to provision AWS resources to run EC2 worker nodes for [Elastic Kubernetes Service](https://aws.amazon.com/eks/).

Instantiate it multiple times to create many EKS worker node pools with specific settings such as GPUs, EC2 instance types, or autoscale parameters.

---

> [!NOTE]
> This project is part of Cloud Posse's comprehensive ["SweetOps"](https://cpco.io/homepage?utm_source=github&utm_medium=readme&utm_campaign=cloudposse/terraform-aws-eks-workers&utm_content=) approach towards DevOps.
>
> <details><summary><strong>Learn More</strong></summary>
> <a href="https://cpco.io/terraform-modules?utm_source=github&utm_medium=readme&utm_campaign=cloudposse/terraform-aws-eks-workers&utm_content=terraform_modules">
>   <picture>
>     <source media="(prefers-color-scheme: dark)" srcset="https://docs.cloudposse.com/images/terraform-open-source-modules-light.svg">
>     <source media="(prefers-color-scheme: light)" srcset="https://docs.cloudposse.com/images/terraform-open-source-modules-dark.svg">
>     <img alt="Terraform Open Source Modules" src="https://docs.cloudposse.com/images/terraform-open-source-modules.svg" align="right">
>   </picture>
> </a>
>
> It's 100% Open Source and licensed under the [APACHE2](LICENSE).
>
> We literally have [_hundreds of terraform modules_](https://cpco.io/terraform-modules?utm_source=github&utm_medium=readme&utm_campaign=cloudposse/terraform-aws-eks-workers&utm_content=terraform_modules) that are Open Source and well-maintained. Check them out!
>
> </details>

<a href="https://cloudposse.com/readme/header/link?utm_source=github&utm_medium=readme&utm_campaign=cloudposse/terraform-aws-eks-workers&utm_content=readme_header_link"><img src="https://cloudposse.com/readme/header/img"/></a>

## Introduction

The module provisions the following resources:

- IAM Role and Instance Profile to allow Kubernetes nodes to access other AWS services
- Security Group with rules for EKS workers to allow networking traffic
- AutoScaling Group with Launch Template to configure and launch worker instances
- AutoScaling Policies and CloudWatch Metric Alarms to monitor CPU utilization on the EC2 instances and scale the number of instance in the AutoScaling Group up or down.
  If you don't want to use the provided functionality, or want to provide your own policies, disable it by setting the variable `autoscaling_policies_enabled` to `"false"`.

## Usage

> [!IMPORTANT]
> In Cloud Posse's examples, we avoid pinning modules to specific versions to prevent discrepancies between the documentation
> and the latest released versions. However, for your own projects, we strongly advise pinning each module to the exact version
> you're using. This practice ensures the stability of your infrastructure. Additionally, we recommend implementing a systematic
> approach for updating versions to avoid unexpected changes.

For a complete example, see [examples/complete](examples/complete)

```hcl
  provider "aws" {
    region = var.region
  }

  locals {
    # The usage of the specific kubernetes.io/cluster/* resource tags below are required
    # for EKS and Kubernetes to discover and manage networking resources
    # https://www.terraform.io/docs/providers/aws/guides/eks-getting-started.html#base-vpc-networking
    tags = merge(var.tags, map("kubernetes.io/cluster/${var.cluster_name}", "shared"))
  }

  module "vpc" {
    source  = "cloudposse/vpc/aws"
    version = "2.1.1"

    namespace = var.namespace
    stage     = var.stage
    name      = var.name

    ipv4_primary_cidr_block = "172.16.0.0/16"
    tags                    = local.tags
  }

  module "subnets" {
    source  = "cloudposse/dynamic-subnets/aws"
    version = "2.4.1"

    namespace = var.namespace
    stage     = var.stage
    name      = var.name

    availability_zones   = var.availability_zones
    vpc_id               = module.vpc.vpc_id
    igw_id               = [module.vpc.igw_id]
    ipv4_cidr_block      = [module.vpc.vpc_cidr_block]
    nat_gateway_enabled  = false
    nat_instance_enabled = false
    tags                 = local.tags
  }

  module "eks_workers" {
    source = "cloudposse/eks-workers/aws"
    # Cloud Posse recommends pinning every module to a specific version
    # version     = "x.x.x"
    namespace                          = var.namespace
    stage                              = var.stage
    name                               = var.name
    instance_type                      = var.instance_type
    vpc_id                             = module.vpc.vpc_id
    subnet_ids                         = module.subnets.public_subnet_ids
    health_check_type                  = var.health_check_type
    min_size                           = var.min_size
    max_size                           = var.max_size
    wait_for_capacity_timeout          = var.wait_for_capacity_timeout
    cluster_name                       = var.cluster_name
    cluster_endpoint                   = var.cluster_endpoint
    cluster_certificate_authority_data = var.cluster_certificate_authority_data
    cluster_security_group_id          = var.cluster_security_group_id

    # Auto-scaling policies and CloudWatch metric alarms
    autoscaling_policies_enabled           = var.autoscaling_policies_enabled
    cpu_utilization_high_threshold_percent = var.cpu_utilization_high_threshold_percent
    cpu_utilization_low_threshold_percent  = var.cpu_utilization_low_threshold_percent
  }
```

<!-- markdownlint-disable -->

## Makefile Targets

```text
Available targets:

  help                                Help screen
  help/all                            Display help for all targets
  help/short                          This help short screen
  lint                                Lint terraform code

```

<!-- markdownlint-restore -->
<!-- markdownlint-disable -->

## Requirements

| Name                                                                     | Version   |
| ------------------------------------------------------------------------ | --------- |
| <a name="requirement_terraform"></a> [terraform](#requirement_terraform) | >= 1.0    |
| <a name="requirement_aws"></a> [aws](#requirement_aws)                   | >= 5.16.0 |

## Providers

| Name                                             | Version   |
| ------------------------------------------------ | --------- |
| <a name="provider_aws"></a> [aws](#provider_aws) | >= 5.16.0 |

## Modules

| Name                                                                             | Source                             | Version |
| -------------------------------------------------------------------------------- | ---------------------------------- | ------- |
| <a name="module_autoscale_group"></a> [autoscale_group](#module_autoscale_group) | cloudposse/ec2-autoscale-group/aws | 0.39.0  |
| <a name="module_label"></a> [label](#module_label)                               | cloudposse/label/null              | 0.25.0  |
| <a name="module_this"></a> [this](#module_this)                                  | cloudposse/label/null              | 0.25.0  |

## Resources

| Name                                                                                                                                                                                  | Type        |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------- |
| [aws_iam_instance_profile.default](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_instance_profile)                                                  | resource    |
| [aws_iam_role.default](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_role)                                                                          | resource    |
| [aws_iam_role_policy_attachment.amazon_ec2_container_registry_read_only](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_role_policy_attachment)      | resource    |
| [aws_iam_role_policy_attachment.amazon_eks_cni_policy](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_role_policy_attachment)                        | resource    |
| [aws_iam_role_policy_attachment.amazon_eks_worker_node_policy](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_role_policy_attachment)                | resource    |
| [aws_iam_role_policy_attachment.existing_policies_attach_to_eks_workers_role](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_role_policy_attachment) | resource    |
| [aws_security_group.default](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group)                                                              | resource    |
| [aws_security_group_rule.egress](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group_rule)                                                     | resource    |
| [aws_security_group_rule.ingress_cidr_blocks](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group_rule)                                        | resource    |
| [aws_security_group_rule.ingress_cluster](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group_rule)                                            | resource    |
| [aws_security_group_rule.ingress_security_groups](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group_rule)                                    | resource    |
| [aws_security_group_rule.ingress_self](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/security_group_rule)                                               | resource    |
| [aws_ami.eks_worker](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/ami)                                                                              | data source |
| [aws_iam_instance_profile.default](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/iam_instance_profile)                                               | data source |
| [aws_iam_policy_document.assume_role](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/iam_policy_document)                                             | data source |
| [aws_partition.current](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/partition)                                                                     | data source |

## Inputs

| Name                                                                                                                                                   | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | Type                                                                                                                                                                                                                                                                                                                                                                                                            | Default                                                                                                                                                                                                                                                                                                                                                                                                                                                           | Required |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------: |
| <a name="input_additional_security_group_ids"></a> [additional_security_group_ids](#input_additional_security_group_ids)                               | Additional list of security groups that will be attached to the autoscaling group                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | `list(string)`                                                                                                                                                                                                                                                                                                                                                                                                  | `[]`                                                                                                                                                                                                                                                                                                                                                                                                                                                              |    no    |
| <a name="input_additional_tag_map"></a> [additional_tag_map](#input_additional_tag_map)                                                                | Additional key-value pairs to add to each map in `tags_as_list_of_maps`. Not added to `tags` or `id`.<br>This is for some rare cases where resources want additional configuration of tags<br>and therefore take a list of maps with tag key, value, and additional configuration.                                                                                                                                                                                                                                                                                                                                                                                   | `map(string)`                                                                                                                                                                                                                                                                                                                                                                                                   | `{}`                                                                                                                                                                                                                                                                                                                                                                                                                                                              |    no    |
| <a name="input_after_cluster_joining_userdata"></a> [after_cluster_joining_userdata](#input_after_cluster_joining_userdata)                            | Additional commands to execute on each worker node after joining the EKS cluster (after executing the `bootstrap.sh` script). For mot info, see https://kubedex.com/90-days-of-aws-eks-in-production                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `string`                                                                                                                                                                                                                                                                                                                                                                                                        | `""`                                                                                                                                                                                                                                                                                                                                                                                                                                                              |    no    |
| <a name="input_allowed_cidr_blocks"></a> [allowed_cidr_blocks](#input_allowed_cidr_blocks)                                                             | List of CIDR blocks to be allowed to connect to the worker nodes                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | `list(string)`                                                                                                                                                                                                                                                                                                                                                                                                  | `[]`                                                                                                                                                                                                                                                                                                                                                                                                                                                              |    no    |
| <a name="input_allowed_security_groups"></a> [allowed_security_groups](#input_allowed_security_groups)                                                 | List of Security Group IDs to be allowed to connect to the worker nodes                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `list(string)`                                                                                                                                                                                                                                                                                                                                                                                                  | `[]`                                                                                                                                                                                                                                                                                                                                                                                                                                                              |    no    |
| <a name="input_associate_public_ip_address"></a> [associate_public_ip_address](#input_associate_public_ip_address)                                     | Associate a public IP address with an instance in a VPC                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `bool`                                                                                                                                                                                                                                                                                                                                                                                                          | `false`                                                                                                                                                                                                                                                                                                                                                                                                                                                           |    no    |
| <a name="input_attributes"></a> [attributes](#input_attributes)                                                                                        | ID element. Additional attributes (e.g. `workers` or `cluster`) to add to `id`,<br>in the order they appear in the list. New attributes are appended to the<br>end of the list. The elements of the list are joined by the `delimiter`<br>and treated as a single ID element.                                                                                                                                                                                                                                                                                                                                                                                        | `list(string)`                                                                                                                                                                                                                                                                                                                                                                                                  | `[]`                                                                                                                                                                                                                                                                                                                                                                                                                                                              |    no    |
| <a name="input_autoscaling_group_tags"></a> [autoscaling_group_tags](#input_autoscaling_group_tags)                                                    | Additional tags only for the autoscaling group, e.g. "k8s.io/cluster-autoscaler/node-template/taint/dedicated" = "ci-cd:NoSchedule".                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `map(string)`                                                                                                                                                                                                                                                                                                                                                                                                   | `{}`                                                                                                                                                                                                                                                                                                                                                                                                                                                              |    no    |
| <a name="input_autoscaling_policies_enabled"></a> [autoscaling_policies_enabled](#input_autoscaling_policies_enabled)                                  | Whether to create `aws_autoscaling_policy` and `aws_cloudwatch_metric_alarm` resources to control Auto Scaling                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | `bool`                                                                                                                                                                                                                                                                                                                                                                                                          | `true`                                                                                                                                                                                                                                                                                                                                                                                                                                                            |    no    |
| <a name="input_aws_iam_instance_profile_name"></a> [aws_iam_instance_profile_name](#input_aws_iam_instance_profile_name)                               | The name of the existing instance profile that will be used in autoscaling group for EKS workers. If empty will create a new instance profile.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | `string`                                                                                                                                                                                                                                                                                                                                                                                                        | `""`                                                                                                                                                                                                                                                                                                                                                                                                                                                              |    no    |
| <a name="input_before_cluster_joining_userdata"></a> [before_cluster_joining_userdata](#input_before_cluster_joining_userdata)                         | Additional commands to execute on each worker node before joining the EKS cluster (before executing the `bootstrap.sh` script). For mot info, see https://kubedex.com/90-days-of-aws-eks-in-production                                                                                                                                                                                                                                                                                                                                                                                                                                                               | `string`                                                                                                                                                                                                                                                                                                                                                                                                        | `""`                                                                                                                                                                                                                                                                                                                                                                                                                                                              |    no    |
| <a name="input_block_device_mappings"></a> [block_device_mappings](#input_block_device_mappings)                                                       | Specify volumes to attach to the instance besides the volumes specified by the AMI                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | <pre>list(object({<br> device_name = string<br> no_device = bool<br> virtual_name = string<br> ebs = object({<br> delete_on_termination = bool<br> encrypted = bool<br> iops = number<br> kms_key_id = string<br> snapshot_id = string<br> volume_size = number<br> volume_type = string<br> })<br> }))</pre>                                                                                                   | `[]`                                                                                                                                                                                                                                                                                                                                                                                                                                                              |    no    |
| <a name="input_bootstrap_extra_args"></a> [bootstrap_extra_args](#input_bootstrap_extra_args)                                                          | Extra arguments to the `bootstrap.sh` script to enable `--enable-docker-bridge` or `--use-max-pods`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `string`                                                                                                                                                                                                                                                                                                                                                                                                        | `""`                                                                                                                                                                                                                                                                                                                                                                                                                                                              |    no    |
| <a name="input_cluster_certificate_authority_data"></a> [cluster_certificate_authority_data](#input_cluster_certificate_authority_data)                | The base64 encoded certificate data required to communicate with the cluster                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | `string`                                                                                                                                                                                                                                                                                                                                                                                                        | n/a                                                                                                                                                                                                                                                                                                                                                                                                                                                               |   yes    |
| <a name="input_cluster_endpoint"></a> [cluster_endpoint](#input_cluster_endpoint)                                                                      | EKS cluster endpoint                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `string`                                                                                                                                                                                                                                                                                                                                                                                                        | n/a                                                                                                                                                                                                                                                                                                                                                                                                                                                               |   yes    |
| <a name="input_cluster_name"></a> [cluster_name](#input_cluster_name)                                                                                  | The name of the EKS cluster                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | `string`                                                                                                                                                                                                                                                                                                                                                                                                        | n/a                                                                                                                                                                                                                                                                                                                                                                                                                                                               |   yes    |
| <a name="input_cluster_security_group_id"></a> [cluster_security_group_id](#input_cluster_security_group_id)                                           | Security Group ID of the EKS cluster                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `string`                                                                                                                                                                                                                                                                                                                                                                                                        | n/a                                                                                                                                                                                                                                                                                                                                                                                                                                                               |   yes    |
| <a name="input_cluster_security_group_ingress_enabled"></a> [cluster_security_group_ingress_enabled](#input_cluster_security_group_ingress_enabled)    | Whether to enable the EKS cluster Security Group as ingress to workers Security Group                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `bool`                                                                                                                                                                                                                                                                                                                                                                                                          | `true`                                                                                                                                                                                                                                                                                                                                                                                                                                                            |    no    |
| <a name="input_context"></a> [context](#input_context)                                                                                                 | Single object for setting entire context at once.<br>See description of individual variables for details.<br>Leave string and numeric variables as `null` to use default value.<br>Individual variable settings (non-null) override settings in context object,<br>except for attributes, tags, and additional_tag_map, which are merged.                                                                                                                                                                                                                                                                                                                            | `any`                                                                                                                                                                                                                                                                                                                                                                                                           | <pre>{<br> "additional_tag_map": {},<br> "attributes": [],<br> "delimiter": null,<br> "descriptor_formats": {},<br> "enabled": true,<br> "environment": null,<br> "id_length_limit": null,<br> "label_key_case": null,<br> "label_order": [],<br> "label_value_case": null,<br> "labels_as_tags": [<br> "unset"<br> ],<br> "name": null,<br> "namespace": null,<br> "regex_replace_chars": null,<br> "stage": null,<br> "tags": {},<br> "tenant": null<br>}</pre> |    no    |
| <a name="input_cpu_utilization_high_evaluation_periods"></a> [cpu_utilization_high_evaluation_periods](#input_cpu_utilization_high_evaluation_periods) | The number of periods over which data is compared to the specified threshold                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | `number`                                                                                                                                                                                                                                                                                                                                                                                                        | `2`                                                                                                                                                                                                                                                                                                                                                                                                                                                               |    no    |
| <a name="input_cpu_utilization_high_period_seconds"></a> [cpu_utilization_high_period_seconds](#input_cpu_utilization_high_period_seconds)             | The period in seconds over which the specified statistic is applied                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `number`                                                                                                                                                                                                                                                                                                                                                                                                        | `300`                                                                                                                                                                                                                                                                                                                                                                                                                                                             |    no    |
| <a name="input_cpu_utilization_high_statistic"></a> [cpu_utilization_high_statistic](#input_cpu_utilization_high_statistic)                            | The statistic to apply to the alarm's associated metric. Either of the following is supported: `SampleCount`, `Average`, `Sum`, `Minimum`, `Maximum`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `string`                                                                                                                                                                                                                                                                                                                                                                                                        | `"Average"`                                                                                                                                                                                                                                                                                                                                                                                                                                                       |    no    |
| <a name="input_cpu_utilization_high_threshold_percent"></a> [cpu_utilization_high_threshold_percent](#input_cpu_utilization_high_threshold_percent)    | The value against which the specified statistic is compared                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | `number`                                                                                                                                                                                                                                                                                                                                                                                                        | `90`                                                                                                                                                                                                                                                                                                                                                                                                                                                              |    no    |
| <a name="input_cpu_utilization_low_evaluation_periods"></a> [cpu_utilization_low_evaluation_periods](#input_cpu_utilization_low_evaluation_periods)    | The number of periods over which data is compared to the specified threshold                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | `number`                                                                                                                                                                                                                                                                                                                                                                                                        | `2`                                                                                                                                                                                                                                                                                                                                                                                                                                                               |    no    |
| <a name="input_cpu_utilization_low_period_seconds"></a> [cpu_utilization_low_period_seconds](#input_cpu_utilization_low_period_seconds)                | The period in seconds over which the specified statistic is applied                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `number`                                                                                                                                                                                                                                                                                                                                                                                                        | `300`                                                                                                                                                                                                                                                                                                                                                                                                                                                             |    no    |
| <a name="input_cpu_utilization_low_statistic"></a> [cpu_utilization_low_statistic](#input_cpu_utilization_low_statistic)                               | The statistic to apply to the alarm's associated metric. Either of the following is supported: `SampleCount`, `Average`, `Sum`, `Minimum`, `Maximum`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `string`                                                                                                                                                                                                                                                                                                                                                                                                        | `"Average"`                                                                                                                                                                                                                                                                                                                                                                                                                                                       |    no    |
| <a name="input_cpu_utilization_low_threshold_percent"></a> [cpu_utilization_low_threshold_percent](#input_cpu_utilization_low_threshold_percent)       | The value against which the specified statistic is compared                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | `number`                                                                                                                                                                                                                                                                                                                                                                                                        | `10`                                                                                                                                                                                                                                                                                                                                                                                                                                                              |    no    |
| <a name="input_credit_specification"></a> [credit_specification](#input_credit_specification)                                                          | Customize the credit specification of the instances                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | <pre>object({<br> cpu_credits = string<br> })</pre>                                                                                                                                                                                                                                                                                                                                                             | `null`                                                                                                                                                                                                                                                                                                                                                                                                                                                            |    no    |
| <a name="input_default_cooldown"></a> [default_cooldown](#input_default_cooldown)                                                                      | The amount of time, in seconds, after a scaling activity completes before another scaling activity can start                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | `number`                                                                                                                                                                                                                                                                                                                                                                                                        | `300`                                                                                                                                                                                                                                                                                                                                                                                                                                                             |    no    |
| <a name="input_delimiter"></a> [delimiter](#input_delimiter)                                                                                           | Delimiter to be used between ID elements.<br>Defaults to `-` (hyphen). Set to `""` to use no delimiter at all.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | `string`                                                                                                                                                                                                                                                                                                                                                                                                        | `null`                                                                                                                                                                                                                                                                                                                                                                                                                                                            |    no    |
| <a name="input_descriptor_formats"></a> [descriptor_formats](#input_descriptor_formats)                                                                | Describe additional descriptors to be output in the `descriptors` output map.<br>Map of maps. Keys are names of descriptors. Values are maps of the form<br>`{<br>   format = string<br>   labels = list(string)<br>}`<br>(Type is `any` so the map values can later be enhanced to provide additional options.)<br>`format` is a Terraform format string to be passed to the `format()` function.<br>`labels` is a list of labels, in order, to pass to `format()` function.<br>Label values will be normalized before being passed to `format()` so they will be<br>identical to how they appear in `id`.<br>Default is `{}` (`descriptors` output will be empty). | `any`                                                                                                                                                                                                                                                                                                                                                                                                           | `{}`                                                                                                                                                                                                                                                                                                                                                                                                                                                              |    no    |
| <a name="input_disable_api_termination"></a> [disable_api_termination](#input_disable_api_termination)                                                 | If `true`, enables EC2 Instance Termination Protection                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | `bool`                                                                                                                                                                                                                                                                                                                                                                                                          | `false`                                                                                                                                                                                                                                                                                                                                                                                                                                                           |    no    |
| <a name="input_ebs_optimized"></a> [ebs_optimized](#input_ebs_optimized)                                                                               | If true, the launched EC2 instance will be EBS-optimized                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | `bool`                                                                                                                                                                                                                                                                                                                                                                                                          | `false`                                                                                                                                                                                                                                                                                                                                                                                                                                                           |    no    |
| <a name="input_eks_worker_ami_name_filter"></a> [eks_worker_ami_name_filter](#input_eks_worker_ami_name_filter)                                        | AMI name filter to lookup the most recent EKS AMI if `image_id` is not provided                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | `string`                                                                                                                                                                                                                                                                                                                                                                                                        | `"amazon-eks-node-*"`                                                                                                                                                                                                                                                                                                                                                                                                                                             |    no    |
| <a name="input_eks_worker_ami_name_regex"></a> [eks_worker_ami_name_regex](#input_eks_worker_ami_name_regex)                                           | A regex string to apply to the AMI list returned by AWS                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `string`                                                                                                                                                                                                                                                                                                                                                                                                        | `"^amazon-eks-node-[0-9,.]+-v[0-9]{8}$"`                                                                                                                                                                                                                                                                                                                                                                                                                          |    no    |
| <a name="input_elastic_gpu_specifications"></a> [elastic_gpu_specifications](#input_elastic_gpu_specifications)                                        | Specifications of Elastic GPU to attach to the instances                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | <pre>object({<br> type = string<br> })</pre>                                                                                                                                                                                                                                                                                                                                                                    | `null`                                                                                                                                                                                                                                                                                                                                                                                                                                                            |    no    |
| <a name="input_enable_monitoring"></a> [enable_monitoring](#input_enable_monitoring)                                                                   | Enable/disable detailed monitoring                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | `bool`                                                                                                                                                                                                                                                                                                                                                                                                          | `true`                                                                                                                                                                                                                                                                                                                                                                                                                                                            |    no    |
| <a name="input_enabled"></a> [enabled](#input_enabled)                                                                                                 | Set to false to prevent the module from creating any resources                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | `bool`                                                                                                                                                                                                                                                                                                                                                                                                          | `null`                                                                                                                                                                                                                                                                                                                                                                                                                                                            |    no    |
| <a name="input_enabled_metrics"></a> [enabled_metrics](#input_enabled_metrics)                                                                         | A list of metrics to collect. The allowed values are `GroupMinSize`, `GroupMaxSize`, `GroupDesiredCapacity`, `GroupInServiceInstances`, `GroupPendingInstances`, `GroupStandbyInstances`, `GroupTerminatingInstances`, `GroupTotalInstances`                                                                                                                                                                                                                                                                                                                                                                                                                         | `list(string)`                                                                                                                                                                                                                                                                                                                                                                                                  | <pre>[<br> "GroupMinSize",<br> "GroupMaxSize",<br> "GroupDesiredCapacity",<br> "GroupInServiceInstances",<br> "GroupPendingInstances",<br> "GroupStandbyInstances",<br> "GroupTerminatingInstances",<br> "GroupTotalInstances"<br>]</pre>                                                                                                                                                                                                                         |    no    |
| <a name="input_environment"></a> [environment](#input_environment)                                                                                     | ID element. Usually used for region e.g. 'uw2', 'us-west-2', OR role 'prod', 'staging', 'dev', 'UAT'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `string`                                                                                                                                                                                                                                                                                                                                                                                                        | `null`                                                                                                                                                                                                                                                                                                                                                                                                                                                            |    no    |
| <a name="input_force_delete"></a> [force_delete](#input_force_delete)                                                                                  | Allows deleting the autoscaling group without waiting for all instances in the pool to terminate. You can force an autoscaling group to delete even if it's in the process of scaling a resource. Normally, Terraform drains all the instances before deleting the group. This bypasses that behavior and potentially leaves resources dangling                                                                                                                                                                                                                                                                                                                      | `bool`                                                                                                                                                                                                                                                                                                                                                                                                          | `false`                                                                                                                                                                                                                                                                                                                                                                                                                                                           |    no    |
| <a name="input_health_check_grace_period"></a> [health_check_grace_period](#input_health_check_grace_period)                                           | Time (in seconds) after instance comes into service before checking health                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | `number`                                                                                                                                                                                                                                                                                                                                                                                                        | `300`                                                                                                                                                                                                                                                                                                                                                                                                                                                             |    no    |
| <a name="input_health_check_type"></a> [health_check_type](#input_health_check_type)                                                                   | Controls how health checking is done. Valid values are `EC2` or `ELB`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `string`                                                                                                                                                                                                                                                                                                                                                                                                        | `"EC2"`                                                                                                                                                                                                                                                                                                                                                                                                                                                           |    no    |
| <a name="input_id_length_limit"></a> [id_length_limit](#input_id_length_limit)                                                                         | Limit `id` to this many characters (minimum 6).<br>Set to `0` for unlimited length.<br>Set to `null` for keep the existing setting, which defaults to `0`.<br>Does not affect `id_full`.                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | `number`                                                                                                                                                                                                                                                                                                                                                                                                        | `null`                                                                                                                                                                                                                                                                                                                                                                                                                                                            |    no    |
| <a name="input_image_id"></a> [image_id](#input_image_id)                                                                                              | EC2 image ID to launch. If not provided, the module will lookup the most recent EKS AMI. See https://docs.aws.amazon.com/eks/latest/userguide/eks-optimized-ami.html for more details on EKS-optimized images                                                                                                                                                                                                                                                                                                                                                                                                                                                        | `string`                                                                                                                                                                                                                                                                                                                                                                                                        | `""`                                                                                                                                                                                                                                                                                                                                                                                                                                                              |    no    |
| <a name="input_instance_initiated_shutdown_behavior"></a> [instance_initiated_shutdown_behavior](#input_instance_initiated_shutdown_behavior)          | Shutdown behavior for the instances. Can be `stop` or `terminate`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | `string`                                                                                                                                                                                                                                                                                                                                                                                                        | `"terminate"`                                                                                                                                                                                                                                                                                                                                                                                                                                                     |    no    |
| <a name="input_instance_market_options"></a> [instance_market_options](#input_instance_market_options)                                                 | The market (purchasing) option for the instances                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | <pre>object({<br> market_type = string<br> spot_options = object({<br> block_duration_minutes = number<br> instance_interruption_behavior = string<br> max_price = number<br> spot_instance_type = string<br> valid_until = string<br> })<br> })</pre>                                                                                                                                                          | `null`                                                                                                                                                                                                                                                                                                                                                                                                                                                            |    no    |
| <a name="input_instance_type"></a> [instance_type](#input_instance_type)                                                                               | Instance type to launch                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `string`                                                                                                                                                                                                                                                                                                                                                                                                        | n/a                                                                                                                                                                                                                                                                                                                                                                                                                                                               |   yes    |
| <a name="input_key_name"></a> [key_name](#input_key_name)                                                                                              | SSH key name that should be used for the instance                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | `string`                                                                                                                                                                                                                                                                                                                                                                                                        | `""`                                                                                                                                                                                                                                                                                                                                                                                                                                                              |    no    |
| <a name="input_kubelet_extra_args"></a> [kubelet_extra_args](#input_kubelet_extra_args)                                                                | Extra arguments to pass to kubelet, like "--register-with-taints=dedicated=ci-cd:NoSchedule --node-labels=purpose=ci-worker"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | `string`                                                                                                                                                                                                                                                                                                                                                                                                        | `""`                                                                                                                                                                                                                                                                                                                                                                                                                                                              |    no    |
| <a name="input_label_key_case"></a> [label_key_case](#input_label_key_case)                                                                            | Controls the letter case of the `tags` keys (label names) for tags generated by this module.<br>Does not affect keys of tags passed in via the `tags` input.<br>Possible values: `lower`, `title`, `upper`.<br>Default value: `title`.                                                                                                                                                                                                                                                                                                                                                                                                                               | `string`                                                                                                                                                                                                                                                                                                                                                                                                        | `null`                                                                                                                                                                                                                                                                                                                                                                                                                                                            |    no    |
| <a name="input_label_order"></a> [label_order](#input_label_order)                                                                                     | The order in which the labels (ID elements) appear in the `id`.<br>Defaults to ["namespace", "environment", "stage", "name", "attributes"].<br>You can omit any of the 6 labels ("tenant" is the 6th), but at least one must be present.                                                                                                                                                                                                                                                                                                                                                                                                                             | `list(string)`                                                                                                                                                                                                                                                                                                                                                                                                  | `null`                                                                                                                                                                                                                                                                                                                                                                                                                                                            |    no    |
| <a name="input_label_value_case"></a> [label_value_case](#input_label_value_case)                                                                      | Controls the letter case of ID elements (labels) as included in `id`,<br>set as tag values, and output by this module individually.<br>Does not affect values of tags passed in via the `tags` input.<br>Possible values: `lower`, `title`, `upper` and `none` (no transformation).<br>Set this to `title` and set `delimiter` to `""` to yield Pascal Case IDs.<br>Default value: `lower`.                                                                                                                                                                                                                                                                          | `string`                                                                                                                                                                                                                                                                                                                                                                                                        | `null`                                                                                                                                                                                                                                                                                                                                                                                                                                                            |    no    |
| <a name="input_labels_as_tags"></a> [labels_as_tags](#input_labels_as_tags)                                                                            | Set of labels (ID elements) to include as tags in the `tags` output.<br>Default is to include all labels.<br>Tags with empty values will not be included in the `tags` output.<br>Set to `[]` to suppress all generated tags.<br>**Notes:**<br> The value of the `name` tag, if included, will be the `id`, not the `name`.<br> Unlike other `null-label` inputs, the initial setting of `labels_as_tags` cannot be<br> changed in later chained modules. Attempts to change it will be silently ignored.                                                                                                                                                            | `set(string)`                                                                                                                                                                                                                                                                                                                                                                                                   | <pre>[<br> "default"<br>]</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                   |    no    |
| <a name="input_load_balancers"></a> [load_balancers](#input_load_balancers)                                                                            | A list of elastic load balancer names to add to the autoscaling group. Only valid for classic load balancers. For ALBs, use `target_group_arns` instead                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `list(string)`                                                                                                                                                                                                                                                                                                                                                                                                  | `[]`                                                                                                                                                                                                                                                                                                                                                                                                                                                              |    no    |
| <a name="input_max_instance_lifetime"></a> [max_instance_lifetime](#input_max_instance_lifetime)                                                       | The maximum amount of time, in seconds, that an instance can be in service, values must be either equal to 0 or between 604800 and 31536000 seconds                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `number`                                                                                                                                                                                                                                                                                                                                                                                                        | `null`                                                                                                                                                                                                                                                                                                                                                                                                                                                            |    no    |
| <a name="input_max_size"></a> [max_size](#input_max_size)                                                                                              | The maximum size of the autoscale group                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `number`                                                                                                                                                                                                                                                                                                                                                                                                        | n/a                                                                                                                                                                                                                                                                                                                                                                                                                                                               |   yes    |
| <a name="input_metadata_http_endpoint_enabled"></a> [metadata_http_endpoint_enabled](#input_metadata_http_endpoint_enabled)                            | Set false to disable the Instance Metadata Service.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `bool`                                                                                                                                                                                                                                                                                                                                                                                                          | `true`                                                                                                                                                                                                                                                                                                                                                                                                                                                            |    no    |
| <a name="input_metadata_http_put_response_hop_limit"></a> [metadata_http_put_response_hop_limit](#input_metadata_http_put_response_hop_limit)          | The desired HTTP PUT response hop limit (between 1 and 64) for Instance Metadata Service requests.<br>The default is `2` to support containerized workloads.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | `number`                                                                                                                                                                                                                                                                                                                                                                                                        | `2`                                                                                                                                                                                                                                                                                                                                                                                                                                                               |    no    |
| <a name="input_metadata_http_tokens_required"></a> [metadata_http_tokens_required](#input_metadata_http_tokens_required)                               | Set true to require IMDS session tokens, disabling Instance Metadata Service Version 1.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `bool`                                                                                                                                                                                                                                                                                                                                                                                                          | `true`                                                                                                                                                                                                                                                                                                                                                                                                                                                            |    no    |
| <a name="input_metrics_granularity"></a> [metrics_granularity](#input_metrics_granularity)                                                             | The granularity to associate with the metrics to collect. The only valid value is 1Minute                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | `string`                                                                                                                                                                                                                                                                                                                                                                                                        | `"1Minute"`                                                                                                                                                                                                                                                                                                                                                                                                                                                       |    no    |
| <a name="input_min_elb_capacity"></a> [min_elb_capacity](#input_min_elb_capacity)                                                                      | Setting this causes Terraform to wait for this number of instances to show up healthy in the ELB only on creation. Updates will not wait on ELB instance number changes                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `number`                                                                                                                                                                                                                                                                                                                                                                                                        | `0`                                                                                                                                                                                                                                                                                                                                                                                                                                                               |    no    |
| <a name="input_min_size"></a> [min_size](#input_min_size)                                                                                              | The minimum size of the autoscale group                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `number`                                                                                                                                                                                                                                                                                                                                                                                                        | n/a                                                                                                                                                                                                                                                                                                                                                                                                                                                               |   yes    |
| <a name="input_mixed_instances_policy"></a> [mixed_instances_policy](#input_mixed_instances_policy)                                                    | policy to used mixed group of on demand/spot of differing types. Launch template is automatically generated. https://www.terraform.io/docs/providers/aws/r/autoscaling_group.html#mixed_instances_policy-1                                                                                                                                                                                                                                                                                                                                                                                                                                                           | <pre>object({<br> instances_distribution = object({<br> on_demand_allocation_strategy = string<br> on_demand_base_capacity = number<br> on_demand_percentage_above_base_capacity = number<br> spot_allocation_strategy = string<br> spot_instance_pools = number<br> spot_max_price = string<br> })<br> override = list(object({<br> instance_type = string<br> weighted_capacity = number<br> }))<br> })</pre> | `null`                                                                                                                                                                                                                                                                                                                                                                                                                                                            |    no    |
| <a name="input_name"></a> [name](#input_name)                                                                                                          | ID element. Usually the component or solution name, e.g. 'app' or 'jenkins'.<br>This is the only ID element not also included as a `tag`.<br>The "name" tag is set to the full `id` string. There is no tag with the value of the `name` input.                                                                                                                                                                                                                                                                                                                                                                                                                      | `string`                                                                                                                                                                                                                                                                                                                                                                                                        | `null`                                                                                                                                                                                                                                                                                                                                                                                                                                                            |    no    |
| <a name="input_namespace"></a> [namespace](#input_namespace)                                                                                           | ID element. Usually an abbreviation of your organization name, e.g. 'eg' or 'cp', to help ensure generated IDs are globally unique                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | `string`                                                                                                                                                                                                                                                                                                                                                                                                        | `null`                                                                                                                                                                                                                                                                                                                                                                                                                                                            |    no    |
| <a name="input_placement"></a> [placement](#input_placement)                                                                                           | The placement specifications of the instances                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | <pre>object({<br> affinity = string<br> availability_zone = string<br> group_name = string<br> host_id = string<br> tenancy = string<br> })</pre>                                                                                                                                                                                                                                                               | `null`                                                                                                                                                                                                                                                                                                                                                                                                                                                            |    no    |
| <a name="input_placement_group"></a> [placement_group](#input_placement_group)                                                                         | The name of the placement group into which you'll launch your instances, if any                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | `string`                                                                                                                                                                                                                                                                                                                                                                                                        | `""`                                                                                                                                                                                                                                                                                                                                                                                                                                                              |    no    |
| <a name="input_protect_from_scale_in"></a> [protect_from_scale_in](#input_protect_from_scale_in)                                                       | Allows setting instance protection. The autoscaling group will not select instances with this setting for terminination during scale in events                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | `bool`                                                                                                                                                                                                                                                                                                                                                                                                          | `false`                                                                                                                                                                                                                                                                                                                                                                                                                                                           |    no    |
| <a name="input_regex_replace_chars"></a> [regex_replace_chars](#input_regex_replace_chars)                                                             | Terraform regular expression (regex) string.<br>Characters matching the regex will be removed from the ID elements.<br>If not set, `"/[^a-zA-Z0-9-]/"` is used to remove all characters other than hyphens, letters and digits.                                                                                                                                                                                                                                                                                                                                                                                                                                      | `string`                                                                                                                                                                                                                                                                                                                                                                                                        | `null`                                                                                                                                                                                                                                                                                                                                                                                                                                                            |    no    |
| <a name="input_scale_down_adjustment_type"></a> [scale_down_adjustment_type](#input_scale_down_adjustment_type)                                        | Specifies whether the adjustment is an absolute number or a percentage of the current capacity. Valid values are `ChangeInCapacity`, `ExactCapacity` and `PercentChangeInCapacity`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | `string`                                                                                                                                                                                                                                                                                                                                                                                                        | `"ChangeInCapacity"`                                                                                                                                                                                                                                                                                                                                                                                                                                              |    no    |
| <a name="input_scale_down_cooldown_seconds"></a> [scale_down_cooldown_seconds](#input_scale_down_cooldown_seconds)                                     | The amount of time, in seconds, after a scaling activity completes and before the next scaling activity can start                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | `number`                                                                                                                                                                                                                                                                                                                                                                                                        | `300`                                                                                                                                                                                                                                                                                                                                                                                                                                                             |    no    |
| <a name="input_scale_down_policy_type"></a> [scale_down_policy_type](#input_scale_down_policy_type)                                                    | The scalling policy type, either `SimpleScaling`, `StepScaling` or `TargetTrackingScaling`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | `string`                                                                                                                                                                                                                                                                                                                                                                                                        | `"SimpleScaling"`                                                                                                                                                                                                                                                                                                                                                                                                                                                 |    no    |
| <a name="input_scale_down_scaling_adjustment"></a> [scale_down_scaling_adjustment](#input_scale_down_scaling_adjustment)                               | The number of instances by which to scale. `scale_down_scaling_adjustment` determines the interpretation of this number (e.g. as an absolute number or as a percentage of the existing Auto Scaling group size). A positive increment adds to the current capacity and a negative value removes from the current capacity                                                                                                                                                                                                                                                                                                                                            | `number`                                                                                                                                                                                                                                                                                                                                                                                                        | `-1`                                                                                                                                                                                                                                                                                                                                                                                                                                                              |    no    |
| <a name="input_scale_up_adjustment_type"></a> [scale_up_adjustment_type](#input_scale_up_adjustment_type)                                              | Specifies whether the adjustment is an absolute number or a percentage of the current capacity. Valid values are `ChangeInCapacity`, `ExactCapacity` and `PercentChangeInCapacity`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | `string`                                                                                                                                                                                                                                                                                                                                                                                                        | `"ChangeInCapacity"`                                                                                                                                                                                                                                                                                                                                                                                                                                              |    no    |
| <a name="input_scale_up_cooldown_seconds"></a> [scale_up_cooldown_seconds](#input_scale_up_cooldown_seconds)                                           | The amount of time, in seconds, after a scaling activity completes and before the next scaling activity can start                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | `number`                                                                                                                                                                                                                                                                                                                                                                                                        | `300`                                                                                                                                                                                                                                                                                                                                                                                                                                                             |    no    |
| <a name="input_scale_up_policy_type"></a> [scale_up_policy_type](#input_scale_up_policy_type)                                                          | The scalling policy type, either `SimpleScaling`, `StepScaling` or `TargetTrackingScaling`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | `string`                                                                                                                                                                                                                                                                                                                                                                                                        | `"SimpleScaling"`                                                                                                                                                                                                                                                                                                                                                                                                                                                 |    no    |
| <a name="input_scale_up_scaling_adjustment"></a> [scale_up_scaling_adjustment](#input_scale_up_scaling_adjustment)                                     | The number of instances by which to scale. `scale_up_adjustment_type` determines the interpretation of this number (e.g. as an absolute number or as a percentage of the existing Auto Scaling group size). A positive increment adds to the current capacity and a negative value removes from the current capacity                                                                                                                                                                                                                                                                                                                                                 | `number`                                                                                                                                                                                                                                                                                                                                                                                                        | `1`                                                                                                                                                                                                                                                                                                                                                                                                                                                               |    no    |
| <a name="input_service_linked_role_arn"></a> [service_linked_role_arn](#input_service_linked_role_arn)                                                 | The ARN of the service-linked role that the ASG will use to call other AWS services                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `string`                                                                                                                                                                                                                                                                                                                                                                                                        | `""`                                                                                                                                                                                                                                                                                                                                                                                                                                                              |    no    |
| <a name="input_stage"></a> [stage](#input_stage)                                                                                                       | ID element. Usually used to indicate role, e.g. 'prod', 'staging', 'source', 'build', 'test', 'deploy', 'release'                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | `string`                                                                                                                                                                                                                                                                                                                                                                                                        | `null`                                                                                                                                                                                                                                                                                                                                                                                                                                                            |    no    |
| <a name="input_subnet_ids"></a> [subnet_ids](#input_subnet_ids)                                                                                        | A list of subnet IDs to launch resources in                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | `list(string)`                                                                                                                                                                                                                                                                                                                                                                                                  | n/a                                                                                                                                                                                                                                                                                                                                                                                                                                                               |   yes    |
| <a name="input_suspended_processes"></a> [suspended_processes](#input_suspended_processes)                                                             | A list of processes to suspend for the AutoScaling Group. The allowed values are `Launch`, `Terminate`, `HealthCheck`, `ReplaceUnhealthy`, `AZRebalance`, `AlarmNotification`, `ScheduledActions`, `AddToLoadBalancer`. Note that if you suspend either the `Launch` or `Terminate` process types, it can prevent your autoscaling group from functioning properly.                                                                                                                                                                                                                                                                                                  | `list(string)`                                                                                                                                                                                                                                                                                                                                                                                                  | `[]`                                                                                                                                                                                                                                                                                                                                                                                                                                                              |    no    |
| <a name="input_tags"></a> [tags](#input_tags)                                                                                                          | Additional tags (e.g. `{'BusinessUnit': 'XYZ'}`).<br>Neither the tag keys nor the tag values will be modified by this module.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | `map(string)`                                                                                                                                                                                                                                                                                                                                                                                                   | `{}`                                                                                                                                                                                                                                                                                                                                                                                                                                                              |    no    |
| <a name="input_target_group_arns"></a> [target_group_arns](#input_target_group_arns)                                                                   | A list of aws_alb_target_group ARNs, for use with Application Load Balancing                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | `list(string)`                                                                                                                                                                                                                                                                                                                                                                                                  | `[]`                                                                                                                                                                                                                                                                                                                                                                                                                                                              |    no    |
| <a name="input_tenant"></a> [tenant](#input_tenant)                                                                                                    | ID element \_(Rarely used, not included by default)\_. A customer identifier, indicating who this instance of a resource is for                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | `string`                                                                                                                                                                                                                                                                                                                                                                                                        | `null`                                                                                                                                                                                                                                                                                                                                                                                                                                                            |    no    |
| <a name="input_termination_policies"></a> [termination_policies](#input_termination_policies)                                                          | A list of policies to decide how the instances in the auto scale group should be terminated. The allowed values are `OldestInstance`, `NewestInstance`, `OldestLaunchConfiguration`, `ClosestToNextInstanceHour`, `Default`                                                                                                                                                                                                                                                                                                                                                                                                                                          | `list(string)`                                                                                                                                                                                                                                                                                                                                                                                                  | <pre>[<br> "Default"<br>]</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                   |    no    |
| <a name="input_use_custom_image_id"></a> [use_custom_image_id](#input_use_custom_image_id)                                                             | If set to `true`, will use variable `image_id` for the EKS workers inside autoscaling group                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | `bool`                                                                                                                                                                                                                                                                                                                                                                                                          | `false`                                                                                                                                                                                                                                                                                                                                                                                                                                                           |    no    |
| <a name="input_use_existing_aws_iam_instance_profile"></a> [use_existing_aws_iam_instance_profile](#input_use_existing_aws_iam_instance_profile)       | If set to `true`, will use variable `aws_iam_instance_profile_name` to run EKS workers using an existing AWS instance profile that was created outside of this module, workaround for error like `count cannot be computed`                                                                                                                                                                                                                                                                                                                                                                                                                                          | `bool`                                                                                                                                                                                                                                                                                                                                                                                                          | `false`                                                                                                                                                                                                                                                                                                                                                                                                                                                           |    no    |
| <a name="input_use_existing_security_group"></a> [use_existing_security_group](#input_use_existing_security_group)                                     | If set to `true`, will use variable `workers_security_group_id` to run EKS workers using an existing security group that was created outside of this module, workaround for errors like `count cannot be computed`                                                                                                                                                                                                                                                                                                                                                                                                                                                   | `bool`                                                                                                                                                                                                                                                                                                                                                                                                          | `false`                                                                                                                                                                                                                                                                                                                                                                                                                                                           |    no    |
| <a name="input_vpc_id"></a> [vpc_id](#input_vpc_id)                                                                                                    | VPC ID for the EKS cluster                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | `string`                                                                                                                                                                                                                                                                                                                                                                                                        | n/a                                                                                                                                                                                                                                                                                                                                                                                                                                                               |   yes    |
| <a name="input_wait_for_capacity_timeout"></a> [wait_for_capacity_timeout](#input_wait_for_capacity_timeout)                                           | A maximum duration that Terraform should wait for ASG instances to be healthy before timing out. Setting this to '0' causes Terraform to skip all Capacity Waiting behavior                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | `string`                                                                                                                                                                                                                                                                                                                                                                                                        | `"10m"`                                                                                                                                                                                                                                                                                                                                                                                                                                                           |    no    |
| <a name="input_wait_for_elb_capacity"></a> [wait_for_elb_capacity](#input_wait_for_elb_capacity)                                                       | Setting this will cause Terraform to wait for exactly this number of healthy instances in all attached load balancers on both create and update operations. Takes precedence over `min_elb_capacity` behavior                                                                                                                                                                                                                                                                                                                                                                                                                                                        | `number`                                                                                                                                                                                                                                                                                                                                                                                                        | `0`                                                                                                                                                                                                                                                                                                                                                                                                                                                               |    no    |
| <a name="input_workers_role_policy_arns"></a> [workers_role_policy_arns](#input_workers_role_policy_arns)                                              | List of policy ARNs that will be attached to the workers default role on creation                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | `list(string)`                                                                                                                                                                                                                                                                                                                                                                                                  | `[]`                                                                                                                                                                                                                                                                                                                                                                                                                                                              |    no    |
| <a name="input_workers_role_policy_arns_count"></a> [workers_role_policy_arns_count](#input_workers_role_policy_arns_count)                            | Count of policy ARNs that will be attached to the workers default role on creation. Needed to prevent Terraform error `count can't be computed`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | `number`                                                                                                                                                                                                                                                                                                                                                                                                        | `0`                                                                                                                                                                                                                                                                                                                                                                                                                                                               |    no    |
| <a name="input_workers_security_group_id"></a> [workers_security_group_id](#input_workers_security_group_id)                                           | The name of the existing security group that will be used in autoscaling group for EKS workers. If empty, a new security group will be created                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | `string`                                                                                                                                                                                                                                                                                                                                                                                                        | `""`                                                                                                                                                                                                                                                                                                                                                                                                                                                              |    no    |

## Outputs

| Name                                                                                                                                                                 | Description                                                            |
| -------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------- |
| <a name="output_autoscaling_group_arn"></a> [autoscaling_group_arn](#output_autoscaling_group_arn)                                                                   | ARN of the AutoScaling Group                                           |
| <a name="output_autoscaling_group_default_cooldown"></a> [autoscaling_group_default_cooldown](#output_autoscaling_group_default_cooldown)                            | Time between a scaling activity and the succeeding scaling activity    |
| <a name="output_autoscaling_group_desired_capacity"></a> [autoscaling_group_desired_capacity](#output_autoscaling_group_desired_capacity)                            | The number of Amazon EC2 instances that should be running in the group |
| <a name="output_autoscaling_group_health_check_grace_period"></a> [autoscaling_group_health_check_grace_period](#output_autoscaling_group_health_check_grace_period) | Time after instance comes into service before checking health          |
| <a name="output_autoscaling_group_health_check_type"></a> [autoscaling_group_health_check_type](#output_autoscaling_group_health_check_type)                         | `EC2` or `ELB`. Controls how health checking is done                   |
| <a name="output_autoscaling_group_id"></a> [autoscaling_group_id](#output_autoscaling_group_id)                                                                      | The AutoScaling Group ID                                               |
| <a name="output_autoscaling_group_max_size"></a> [autoscaling_group_max_size](#output_autoscaling_group_max_size)                                                    | The maximum size of the AutoScaling Group                              |
| <a name="output_autoscaling_group_min_size"></a> [autoscaling_group_min_size](#output_autoscaling_group_min_size)                                                    | The minimum size of the AutoScaling Group                              |
| <a name="output_autoscaling_group_name"></a> [autoscaling_group_name](#output_autoscaling_group_name)                                                                | The AutoScaling Group name                                             |
| <a name="output_autoscaling_group_tags"></a> [autoscaling_group_tags](#output_autoscaling_group_tags)                                                                | A list of tag settings associated with the AutoScaling Group           |
| <a name="output_launch_template_arn"></a> [launch_template_arn](#output_launch_template_arn)                                                                         | ARN of the launch template                                             |
| <a name="output_launch_template_id"></a> [launch_template_id](#output_launch_template_id)                                                                            | The ID of the launch template                                          |
| <a name="output_security_group_arn"></a> [security_group_arn](#output_security_group_arn)                                                                            | ARN of the worker nodes Security Group                                 |
| <a name="output_security_group_id"></a> [security_group_id](#output_security_group_id)                                                                               | ID of the worker nodes Security Group                                  |
| <a name="output_security_group_name"></a> [security_group_name](#output_security_group_name)                                                                         | Name of the worker nodes Security Group                                |
| <a name="output_workers_role_arn"></a> [workers_role_arn](#output_workers_role_arn)                                                                                  | ARN of the worker nodes IAM role                                       |
| <a name="output_workers_role_name"></a> [workers_role_name](#output_workers_role_name)                                                                               | Name of the worker nodes IAM role                                      |

<!-- markdownlint-restore -->

## Related Projects

Check out these related projects.

- [terraform-aws-ec2-autoscale-group](https://github.com/cloudposse/terraform-aws-ec2-autoscale-group) - Terraform module to provision Auto Scaling Group and Launch Template on AWS
- [terraform-aws-ecs-container-definition](https://github.com/cloudposse/terraform-aws-ecs-container-definition) - Terraform module to generate well-formed JSON documents (container definitions) that are passed to the aws_ecs_task_definition Terraform resource
- [terraform-aws-ecs-alb-service-task](https://github.com/cloudposse/terraform-aws-ecs-alb-service-task) - Terraform module which implements an ECS service which exposes a web service via ALB
- [terraform-aws-ecs-web-app](https://github.com/cloudposse/terraform-aws-ecs-web-app) - Terraform module that implements a web app on ECS and supports autoscaling, CI/CD, monitoring, ALB integration, and much more
- [terraform-aws-ecs-codepipeline](https://github.com/cloudposse/terraform-aws-ecs-codepipeline) - Terraform module for CI/CD with AWS Code Pipeline and Code Build for ECS
- [terraform-aws-ecs-cloudwatch-autoscaling](https://github.com/cloudposse/terraform-aws-ecs-cloudwatch-autoscaling) - Terraform module to autoscale ECS Service based on CloudWatch metrics
- [terraform-aws-ecs-cloudwatch-sns-alarms](https://github.com/cloudposse/terraform-aws-ecs-cloudwatch-sns-alarms) - Terraform module to create CloudWatch Alarms on ECS Service level metrics
- [terraform-aws-ec2-instance](https://github.com/cloudposse/terraform-aws-ec2-instance) - Terraform module for providing a general purpose EC2 instance
- [terraform-aws-ec2-instance-group](https://github.com/cloudposse/terraform-aws-ec2-instance-group) - Terraform module for provisioning multiple general purpose EC2 hosts for stateful applications

##  Contributing

This project is under active development, and we encourage contributions from our community.
Many thanks to our outstanding contributors:

<a href="https://github.com/cloudposse/terraform-aws-eks-workers/graphs/contributors">
  <img src="https://contrib.rocks/image?repo=cloudposse/terraform-aws-eks-workers&max=24" />
</a>

###  Bug Reports & Feature Requests

Please use the [issue tracker](https://github.com/cloudposse/terraform-aws-eks-workers/issues) to report any bugs or file feature requests.

###  Developing

If you are interested in being a contributor and want to get involved in developing this project or help out with Cloud Posse's other projects, we would love to hear from you!
Hit us up in [Slack](https://cpco.io/slack?utm_source=github&utm_medium=readme&utm_campaign=cloudposse/terraform-aws-eks-workers&utm_content=slack), in the `#cloudposse` channel.

In general, PRs are welcome. We follow the typical "fork-and-pull" Git workflow.

1.  Review our [Code of Conduct](https://github.com/cloudposse/terraform-aws-eks-workers/?tab=coc-ov-file#code-of-conduct) and [Contributor Guidelines](https://github.com/cloudposse/.github/blob/main/CONTRIBUTING.md).
2.  **Fork** the repo on GitHub
3.  **Clone** the project to your own machine
4.  **Commit** changes to your own branch
5.  **Push** your work back up to your fork
6.  Submit a **Pull Request** so that we can review your changes

**NOTE:** Be sure to merge the latest changes from "upstream" before making a pull request!

###  Slack Community

Join our [Open Source Community](https://cpco.io/slack?utm_source=github&utm_medium=readme&utm_campaign=cloudposse/terraform-aws-eks-workers&utm_content=slack) on Slack. It's **FREE** for everyone! Our "SweetOps" community is where you get to talk with others who share a similar vision for how to rollout and manage infrastructure. This is the best place to talk shop, ask questions, solicit feedback, and work together as a community to build totally _sweet_ infrastructure.

###  Newsletter

Sign up for [our newsletter](https://cpco.io/newsletter?utm_source=github&utm_medium=readme&utm_campaign=cloudposse/terraform-aws-eks-workers&utm_content=newsletter) and join 3,000+ DevOps engineers, CTOs, and founders who get insider access to the latest DevOps trends, so you can always stay in the know.
Dropped straight into your Inbox every week  and usually a 5-minute read.

###  Office Hours <a href="https://cloudposse.com/office-hours?utm_source=github&utm_medium=readme&utm_campaign=cloudposse/terraform-aws-eks-workers&utm_content=office_hours"><img src="https://img.cloudposse.com/fit-in/200x200/https://cloudposse.com/wp-content/uploads/2019/08/Powered-by-Zoom.png" align="right" /></a>

[Join us every Wednesday via Zoom](https://cloudposse.com/office-hours?utm_source=github&utm_medium=readme&utm_campaign=cloudposse/terraform-aws-eks-workers&utm_content=office_hours) for your weekly dose of insider DevOps trends, AWS news and Terraform insights, all sourced from our SweetOps community, plus a _live Q&A_ that you cant find anywhere else.
It's **FREE** for everyone!

## About

This project is maintained by <a href="https://cpco.io/homepage?utm_source=github&utm_medium=readme&utm_campaign=cloudposse/terraform-aws-eks-workers&utm_content=">Cloud Posse, LLC</a>.
<a href="https://cpco.io/homepage?utm_source=github&utm_medium=readme&utm_campaign=cloudposse/terraform-aws-eks-workers&utm_content="><img src="https://cloudposse.com/logo-300x69.svg" align="right" /></a>

We are a [**DevOps Accelerator**](https://cpco.io/commercial-support?utm_source=github&utm_medium=readme&utm_campaign=cloudposse/terraform-aws-eks-workers&utm_content=commercial_support) for funded startups and enterprises.
Use our ready-to-go terraform architecture blueprints for AWS to get up and running quickly.
We build it with you. You own everything. Your team wins. Plus, we stick around until you succeed.

<a href="https://cpco.io/commercial-support?utm_source=github&utm_medium=readme&utm_campaign=cloudposse/terraform-aws-eks-workers&utm_content=commercial_support"><img alt="Learn More" src="https://img.shields.io/badge/learn%20more-success.svg?style=for-the-badge"/></a>

_Your team can operate like a pro today._

Ensure that your team succeeds by using our proven process and turnkey blueprints. Plus, we stick around until you succeed.

<details>
  <summary> <strong>See What's Included</strong></summary>

- **Reference Architecture.** You'll get everything you need from the ground up built using 100% infrastructure as code.
- **Deployment Strategy.** You'll have a battle-tested deployment strategy using GitHub Actions that's automated and repeatable.
- **Site Reliability Engineering.** You'll have total visibility into your apps and microservices.
- **Security Baseline.** You'll have built-in governance with accountability and audit logs for all changes.
- **GitOps.** You'll be able to operate your infrastructure via Pull Requests.
- **Training.** You'll receive hands-on training so your team can operate what we build.
- **Questions.** You'll have a direct line of communication between our teams via a Shared Slack channel.
- **Troubleshooting.** You'll get help to triage when things aren't working.
- **Code Reviews.** You'll receive constructive feedback on Pull Requests.
- **Bug Fixes.** We'll rapidly work with you to fix any bugs in our projects.
</details>

<a href="https://cloudposse.com/readme/commercial-support/link?utm_source=github&utm_medium=readme&utm_campaign=cloudposse/terraform-aws-eks-workers&utm_content=readme_commercial_support_link"><img src="https://cloudposse.com/readme/commercial-support/img"/></a>

## License

<a href="https://opensource.org/licenses/Apache-2.0"><img src="https://img.shields.io/badge/License-Apache%202.0-blue.svg?style=for-the-badge" alt="License"></a>

<details>
<summary>Preamble to the Apache License, Version 2.0</summary>
<br/>
<br/>

Complete license is available in the [`LICENSE`](LICENSE) file.

```text
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

  https://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
```

</details>

## Trademarks

## All other trademarks referenced herein are the property of their respective owners.

Copyright  2017-2024 [Cloud Posse, LLC](https://cpco.io/copyright)

<a href="https://cloudposse.com/readme/footer/link?utm_source=github&utm_medium=readme&utm_campaign=cloudposse/terraform-aws-eks-workers&utm_content=readme_footer_link"><img alt="README footer" src="https://cloudposse.com/readme/footer/img"/></a>

<img alt="Beacon" width="0" src="https://ga-beacon.cloudposse.com/UA-76589703-4/cloudposse/terraform-aws-eks-workers?pixel&cs=github&cm=readme&an=terraform-aws-eks-workers"/>
