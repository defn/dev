#!/usr/bin/env bash

exec 2>&1

export STARSHIP_NO=1
source ~/.bash_profile
direnv allow
mise trust
source .env

export PATH

exec mise exec -- coder server --no-open

exec mise exec -- coder server \
	--oauth2-github-allow-signups --enable-terraform-debug-mode \
	--oauth2-github-allowed-orgs ${coder_oauth2_github_allowed_orgs} \
	--oauth2-github-allowed-teams ${coder_oauth2_github_allowed_teams} \
	--oauth2-github-client-id ${coder_oauth2_github_client_id} \
	--oauth2-github-client-secret ${coder_oauth2_github_client_secret} \
	--access-url "https://coder.${CODER_SERVER_NAME}.$${CODER_SERVER_DOMAIN}" \
	--wildcard-access-url "*.${CODER_SERVER_NAME}.$${CODER_SERVER_DOMAIN}" \
	--tls-cert-file ${CODER_SERVER_NAME}.$${CODER_SERVER_DOMAIN}/fullchain.pem \
	--tls-key-file ${CODER_SERVER_NAME}.$${CODER_SERVER_DOMAIN}/privkey.pem \
	--tls-enable --derp-force-websockets
