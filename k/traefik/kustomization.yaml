namespace: traefik

helmCharts:
- releaseName: traefik
  name: traefik
  namespace: traefik
  version: 10.24.0
  repo: https://helm.traefik.io/traefik
  includeCRDs: true
  valuesInline:
    service:
      type: LoadBalancer

resources:
- tls.yaml
- ingress.yaml

patchesStrategicMerge:
- |-
  apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: traefik
  spec:
    template:
      spec:
        containers:
        - name: traefik
          args:
          - --global.checknewversion=false
          - --global.sendanonymoususage=false
          - --entrypoints.metrics.address=:9100/tcp
          - --entrypoints.traefik.address=:9000/tcp
          - --api.dashboard=true
          - --api.insecure=true
          - --ping=true
          - --metrics.prometheus=true
          - --metrics.prometheus.entrypoint=metrics
          - --providers.kubernetescrd
          - --providers.kubernetescrd.allowCrossNamespace=true
          - --providers.kubernetesingress
          - --entrypoints.web.address=:8000/tcp
          - --entrypoints.websecure.address=:8443/tcp
          - --entryPoints.websecure.forwardedHeaders.insecure
          - --entrypoints.https8200.address=:8200/tcp
          - --entrypoints.https8888.address=:8888/tcp
          - --entrypoints.https9600.address=:9600/tcp
          - --entrypoints.https9601.address=:9601/tcp
          - --entrypoints.https9602.address=:9602/tcp
          - --entrypoints.https9603.address=:9603/tcp
          - --entrypoints.https9604.address=:9604/tcp
          - --entrypoints.https9605.address=:9605/tcp
          - --entrypoints.https9606.address=:9606/tcp
          - --entrypoints.https9607.address=:9607/tcp
          - --entrypoints.https9608.address=:9608/tcp
          - --entrypoints.https9609.address=:9609/tcp
          - --entrypoints.https9700.address=:9700/tcp
          - --entrypoints.https9701.address=:9701/tcp
          - --entrypoints.web.http.redirections.entryPoint.to=:443
          - --entrypoints.web.http.redirections.entryPoint.scheme=https
          - --providers.kubernetescrd.allowexternalnameservices=true
          - --serverstransport.insecureskipverify=true
          - --api.insecure=true
          - --log.level=DEBUG
          - --accesslog=true
          ports:
          - containerPort: 8200
            name: https8200
            protocol: TCP
          - containerPort: 8888
            name: https8888
            protocol: TCP
          - containerPort: 9600
            name: https9600
            protocol: TCP
          - containerPort: 9601
            name: https9601
            protocol: TCP
          - containerPort: 9602
            name: https9602
            protocol: TCP
          - containerPort: 9603
            name: https9603
            protocol: TCP
          - containerPort: 9604
            name: https9604
            protocol: TCP
          - containerPort: 9605
            name: https9605
            protocol: TCP
          - containerPort: 9606
            name: https9606
            protocol: TCP
          - containerPort: 9607
            name: https9607
            protocol: TCP
          - containerPort: 9608
            name: https9608
            protocol: TCP
          - containerPort: 9609
            name: https9609
            protocol: TCP
          - containerPort: 9700
            name: https9700
            protocol: TCP
          - containerPort: 9701
            name: https9701
            protocol: TCP
- |-
  apiVersion: v1
  kind: List
  metadata:
    name: traefik
  items:
    - apiVersion: v1
      kind: Service
      metadata:
        name: traefik
      spec:
        ports:
        - $patch: replace
        - name: http
          port: 80
          protocol: TCP
          targetPort: web
        - name: https
          port: 443
          protocol: TCP
          targetPort: websecure
        - name: web
          port: 8000
          protocol: TCP
          targetPort: web
        - name: websecure
          port: 8443
          protocol: TCP
          targetPort: websecure
        - name: https8200
          port: 8200
          protocol: TCP
          targetPort: https8200
        - name: https8888
          port: 8888
          protocol: TCP
          targetPort: https8888
        - name: https9600
          port: 9600
          protocol: TCP
          targetPort: https9600
        - name: https9601
          port: 9601
          protocol: TCP
          targetPort: https9601
        - name: https9602
          port: 9602
          protocol: TCP
          targetPort: https9602
        - name: https9603
          port: 9603
          protocol: TCP
          targetPort: https9603
        - name: https9604
          port: 9604
          protocol: TCP
          targetPort: https9604
        - name: https9605
          port: 9605
          protocol: TCP
          targetPort: https9605
        - name: https9606
          port: 9606
          protocol: TCP
          targetPort: https9606
        - name: https9607
          port: 9607
          protocol: TCP
          targetPort: https9607
        - name: https9608
          port: 9608
          protocol: TCP
          targetPort: https9608
        - name: https9609
          port: 9609
          protocol: TCP
          targetPort: https9609
        - name: https9700
          port: 9700
          protocol: TCP
          targetPort: https9700
        - name: https9701
          port: 9701
          protocol: TCP
          targetPort: https9701
